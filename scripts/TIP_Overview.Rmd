---
title: "TIP_Overview"
author: "Zach Peagler"
date: "`r Sys.Date()`"
output: 
  html_document:
    theme: sandstone
    toc: yes
    toc_float:
      collapsed: true
---
# Introduction

This analysis was done in accompaniment with my thesis for my Master's of Science in Integrative Biology (MSIB) at Kennesaw State University (KSU). I joined the tomato inoculant project (TIP) in 2022, when I was still in my undergraduate degree at KSU and started doing research with the then lead graduate researcher, Collin Dice. At the time, he was performing foliar applications of *Methylobacterium oryzae* on tomato plants (cultivar **BHN 589**) to which he was also applying *salt stress* treatments. The idea was that the bacteria could help counteract the negative effects of the salt stress, increasing plant health in a variety of ways, including increased photosynthesis and greater fruit yield and quality.

Prior to my involvement in the project, some operations were performed differently, such as all the tomatoes being harvested in a single day. The 2021 results are somewhat incomparable to the other years. 

From year to year, each trial had some element changed.
2021: Foliar applications of M. oryzae, salt stress, 28 plants, single harvest, MultispeQ
2022: Foliar applications of M. oryzae, salt stress, 32 plants, rolling harvest, sugar measurements, MultispeQ
2023: Soil and foliar applications of M. oryzae, 32 plants, rolling harvest, sugar measurements, MultispeQ, Li-600, stomatal density
2024: Soil applications of a cocktail of PGPRs at germination and transplantation, 48 plants, rolling harvest, sugar measurements, MultispeQ, Li-600, stomatal density
# 1. Setup

## 1.1. Load Packages
```{r packages, include=FALSE}
# get packages
## stats packages
require(lme4)
require(multcomp)
require(lmerTest)
require(MuMIn)
require(rstatix)
require(MASS)
require(pwr)
require(car)
## graphical packages
require(tidyverse)
require(showtext)
require(scico)
require(ggpubr)
## custom package
require(devtools)
install_github("zachpeagler/ztils", upgrade = "never")
require(ztils)
```

## 1.2. Graphical Setup
```{r graphical_setup}

a_palette <- "oslo"
# super lazy way to make palettes
two_colors = scico(2, begin = 0.8, end=0.3, palette=a_palette)
four_colors = scico(4, begin = 0.8, end=0.3, palette=a_palette)
five_colors = scico(5, begin = 0.8, end=0.3, palette=a_palette)
ten_col = scico(10, begin = 0.8, end=0.3, palette=a_palette)
twelve_col = scico(12, begin = 0.3, end=0.3, palette=a_palette)
# add fonts
font_add_google("Open Sans", family = "open")
font_add_google("Montserrat", family = "mont")
# initialize imported fonts
showtext_auto()
# font sizes
### you could even put all these into one object, if you felt so inclined
### like this: text_sizes <- c(16, 12, 10)
### then retrieve them like text_sizes[1] etc
## title
title_size = 16
## subtitle
subtitle_size = 12
## caption
caption_size = 10
## text
text_size = 10

# custom shapes
four_shapes = c(15,16,17,23)

```

## 1.3. Experimental Constants
```{r exp_constants}

## germination date
germdate23 <- "2023-04-14"
germdate24 <- "2024-05-01"

## cutoff time
## necessary due to some early morning/late night measurements
### 2022
cutoff22 <- "12:00:00"

## treatment orders
treatment_order21 <- c("Control",
                       "Salt Stress",
                       "Inoculation",
                       "Salt+Inoc")
treatment_order22 <- c("Control",
                       "Salt Stress",
                       "Inoculation",
                       "Salt+Inoc")
treatment_order23 <- c("Control",
                       "Soil",
                       "Foliar", 
                       "Soil+Foliar")
treatment_order24 <- c("Control",
                       "Transplantation",
                       "Germination", 
                       "Germ+Trans")

## plant factor order
### do we even need this?
### p
plant_order24 <- c("A1", "A2", "A3", "A4", "A5", "A6",
                   "A7", "A8", "A9", "A10", "A11", "A12",
                   "B1", "B2", "B3", "B4", "B5", "B6",
                   "B7", "B8", "B9", "B10", "B11", "B12",
                   "C1", "C2", "C3", "C4", "C5", "C6",
                   "C7", "C8", "C9", "C10", "C11", "C12",
                   "D1", "D2", "D3", "D4", "D5", "D6",
                   "D7", "D8", "D9", "D10", "D11", "D12")
```

## 1.4. Load Data
```{r data}
# 2021
d21_f_file <- "https://raw.githubusercontent.com/zachpeagler/Thesis/refs/heads/main/data/TIP/2021/TIP21_Fruit.csv"
d21_m_file <- "https://raw.githubusercontent.com/zachpeagler/Thesis/refs/heads/main/data/TIP/2021/TIP21_Multispeq.csv"

# 2022
d22_f_file <- "https://raw.githubusercontent.com/zachpeagler/Thesis/refs/heads/main/data/TIP/2022/TIP22_Fruit.csv"
d22_m_file <- "https://raw.githubusercontent.com/zachpeagler/Thesis/refs/heads/main/data/TIP/2022/TIP22_Multispeq.csv"

# 2023
d23_fg_file <- "https://raw.githubusercontent.com/zachpeagler/Thesis/refs/heads/main/data/TIP/2023/TIP23_Fruit_Greenhouse.csv"
d23_fl_file <- "https://raw.githubusercontent.com/zachpeagler/Thesis/refs/heads/main/data/TIP/2023/TIP23_Fruit_Lab.csv"
d23_m_file <- "https://raw.githubusercontent.com/zachpeagler/Thesis/refs/heads/main/data/TIP/2023/TIP23_Multispeq.csv"
d23_li_file <- "https://raw.githubusercontent.com/zachpeagler/Thesis/refs/heads/main/data/TIP/2023/TIP23_LI600.csv"
d23_st_file <- "https://raw.githubusercontent.com/zachpeagler/Thesis/refs/heads/main/data/TIP/2023/TIP23_StomatalDensity.csv"

# 2024
d24_f_file <- "https://raw.githubusercontent.com/zachpeagler/Thesis/refs/heads/main/data/TIP/2024/TIP24_Fruit.csv"
d24_m_file <- "https://raw.githubusercontent.com/zachpeagler/Thesis/refs/heads/main/data/TIP/2024/TIP24_Multispeq.csv"
d24_li_file <- "https://raw.githubusercontent.com/zachpeagler/Thesis/refs/heads/main/data/TIP/2024/TIP24_LI600.csv"

```

## 1.5. Clean Data

### 1.5.1. 2021 Data Cleaning
```{r 21cleaning}
# 2021
## fruit
d21_f <- read.csv(d21_f_file) %>% mutate(
  Salt = case_when(
    Salt=="N"~"FALSE",
    Salt=="Y"~"TRUE"
  ),
  Salt = as.logical(Salt),
  Inoculated = case_when(
    Inoculated =="N"~"FALSE",
    Inoculated =="Y"~"TRUE"
  ),
  Inoculated = as.logical(Inoculated),
  BER = case_when(
    BER=="N"~"FALSE",
    BER=="Y"~"TRUE"
  ),
  BER = as.logical(BER)
)

a_temp <- data.frame(a=character(0))
b_temp <- data.frame(b=numeric(0))

for (x in seq_len(nrow(d21_f))) {
  a = strsplit(d21_f$Pot, split="")[[x]][1]
  b = strsplit(d21_f$Pot, split="")[[x]][2]
  a_temp <- rbind(a_temp, a)
  b_temp <- rbind(b_temp, b)
} 

d21_f$Row <- a_temp$X.A.
d21_f$Plant <- as.factor(d21_f$Pot)
d21_f$Pot <- b_temp$X.1.
d21_f$Pot <- as.factor(d21_f$Pot)
d21_f <- d21_f %>%
    mutate(
      Row_num = case_when(
        Row=="A"~ 1,
        Row=="B"~ 2,
        Row=="C"~ 3,
        Row=="D"~ 4,
        TRUE~NA),
      treatment = case_when(
        Salt == TRUE & Inoculated == TRUE ~ "Salt+Inoc",
        Salt == TRUE & Inoculated == FALSE ~ "Salt Stress",
        Salt == FALSE & Inoculated == TRUE ~ "Inoculation",
        Salt == FALSE & Inoculated == FALSE ~ "Control",
        TRUE~NA),
      treatment = factor(treatment, levels = treatment_order21)
    )
d21_f$Row <- as.factor(d21_f$Row) 
colnames(d21_f) <- tolower(colnames(d21_f))
d21_f <- d21_f %>%
  rename(mass = fruitweight) %>%
  mutate(fruitnumber = 1)

### Make summary dataframe with mean and sd of mass and sugar by plant.
d21_f_means <- d21_f %>%
  group_by(treatment, plant) %>%
  summarise_at(vars(mass), list(mean=mean, sd=sd))

### Sum the fruit, BER, and mass by treatment group, then get ber probability.
d21_f_summary <- d21_f %>%
  group_by(treatment) %>%
  summarise_at(vars(fruitnumber, mass, ber),
               list(sum=sum)) %>%
  mutate(pber = round(ber_sum/fruitnumber_sum, 4))

### Sum the fruit, BER, and mass by treatment group, then get ber probability.
#### by plant
d21_f_summary_byplant <- d21_f %>%
  group_by(treatment, plant) %>%
  summarise_at(vars(fruitnumber, mass, ber),
               list(sum=sum)) %>%
  mutate(pber = round(ber_sum/fruitnumber_sum, 4))

## multispeq
d21_m <- read.csv(d21_m_file)[,c(1,6,7,8,10,11,12,21,27,34,35,41,53,59)] %>%
  rename(Pot = Pot.ID) %>%
  mutate(
      Row_num = case_when(
      Row=="A"~ 1,
      Row=="B"~ 2,
      Row=="C"~ 3,
      Row=="D"~ 4,
      TRUE~NA),
    Plant = as.factor(paste0(Row, Pot)),
    Treatment = case_when(
        Plant %in% c("A1", "A3", "A5", "B2", "B4", "B6") ~ "Control",
        Plant %in% c("A2", "A4", "A6", "B1", "B3", "B5", "B7") ~ "Salt Stress",
        Plant %in% c("C1", "C3", "C5", "D2", "D4", "D6") ~ "Inoculation", 
        Plant %in% c("C2", "C4", "C6", "C7","D1", "D3", "D5", "D7") ~ "Salt+Inoc"
      ),
    salt = case_when(
      Treatment=="Control"~FALSE,
      Treatment=="Salt Stress"~TRUE,
      Treatment=="Inoculation"~FALSE,
      Treatment=="Salt+Inoc"~TRUE
    ),
    inoculation = case_when(
      Treatment=="Control"~FALSE,
      Treatment=="Salt Stress"~FALSE,
      Treatment=="Inoculation"~TRUE,
      Treatment=="Salt+Inoc"~TRUE
    ),
    Treatment = factor(Treatment, levels = treatment_order21),
    Pot = as.factor(Pot),
    Row = as.factor(Row),
    Device.ID = as.factor(Device.ID),
    Leaf.position = as.factor(Leaf.position),
    Date = as.Date(time, "%m/%d/%Y"),
    Time = parse_date_time(time, "%m/%d/%Y %H:%M %p"),
    Time = format(Time, "%H:%M:%S"),
    logitPS2 = logit(Phi2, FALSE),
    logitFvPFmP = logit(FvP_over_FmP, FALSE)
)
#### a really weird way to remove the original datetime
##### if it's stupid and it works, it ain't stupid
d21_m <- d21_m[,c(1:12,14:23)]
colnames(d21_m) <- tolower(colnames(d21_m))

```


### 1.5.2. 2022 Data Cleaning

Average the two sugar measurements together, then calculate the actual amount of sugar in the fruit with ((sugar_avg / 100) * mass) which gives the calculated sugar in grams.

Filter out all fruit with unsure == TRUE.

```{r 22cleaning}
# 2022
## fruit
d22_f <- read.csv(d22_f_file) %>%
  mutate(
    row = str_trim(row),
    row_num = case_when(
      row=="A"~ 1,
      row=="B"~ 2,
      row=="C"~ 3,
      row=="D"~ 4,
      TRUE~NA),
    treatment = case_when(
      row=="A"~ "Control",
      row=="B"~ "Salt Stress",
      row=="C"~ "Inoculation",
      row=="D"~ "Salt+Inoc",
      ),
    salt = case_when(
      row=="A"~FALSE,
      row=="B"~TRUE,
      row=="C"~FALSE,
      row=="D"~TRUE
    ),
    inoculation = case_when(
      row=="A"~FALSE,
      row=="B"~FALSE,
      row=="C"~TRUE,
      row=="D"~TRUE
    ),
    fruit = 1,
    treatment = factor(treatment, levels=treatment_order22),
    row = as.factor(row),
    plant = as.factor(paste0(row, pot)),
    pot = as.factor(pot),
    ber = case_when(
      ber=="N"~"FALSE",
      ber=="Y"~"TRUE",
      ber=="y"~"TRUE"
    ),
    ber = as.logical(ber),
    eaten = case_when(
      eaten=="N"~"FALSE",
      eaten=="Y"~"TRUE"
    ),
    eaten = as.logical(eaten),
    mold = case_when(
      mold=="N"~"FALSE",
      mold=="Y"~"TRUE"
    ),
    mold = as.logical(mold),
    unsure = case_when(
      unsure=="N"~"FALSE",
      unsure=="Y"~"TRUE"
    ),
    unsure = as.logical(unsure),
    date = paste(date, "2022", sep="-"),
    date = as.Date(date, "%d-%b-%Y"),
    sugar_avg = (sug_1 + sug_2)/ 2,
    sugar_grams = (sugar_avg/100)*mass,
    logitsugar = logit(sugar_avg/100)
  ) %>%
  filter(unsure == FALSE)

## No NAs
d22_f_omitna <- d22_f %>%
  filter(is.na(sugar_avg) == FALSE)
d22_f_omitmassna <- d22_f %>%
  filter(is.na(mass) == FALSE)


### Make summary dataframe with mean and sd of mass and sugar by plant.
d22_f_means <- d22_f_omitmassna %>%
  group_by(treatment) %>%
  summarise_at(vars(mass), list(mean=mean, sd=sd))

### Make summary dataframe with mean and sd of mass and sugar by plant.
#### no NA
d22_f_means_omitna <- d22_f_omitna %>%
  group_by(treatment, plant) %>%
  summarise_at(vars(mass, sugar_avg), list(mean=mean, sd=sd))

### Sum the fruit, BER, eaten, mold, sugar, and mass by treatment group, then get ber, mold, and eaten probability.
d22_f_summary <- d22_f_omitmassna %>%
  group_by(treatment) %>%
  summarise_at(vars(fruit, ber, eaten, mold, mass),
               list(sum=sum)) %>%
  mutate(pber = round(ber_sum/fruit_sum, 4),
         peaten = round(eaten_sum/fruit_sum, 4),
         pmold = round(mold_sum/fruit_sum, 4)
         )

### Sum the fruit, BER, eaten, mold, sugar, and mass by treatment group, then get ber, mold, and eaten probability.
#### omit all NA
d22_f_summary_omitna <- d22_f_omitna %>%
  group_by(treatment) %>%
  summarise_at(vars(fruit, ber, eaten, mold, mass, sugar_avg, sugar_grams),
               list(sum=sum)) %>%
  mutate(pber = round(ber_sum/fruit_sum, 4),
         peaten = round(eaten_sum/fruit_sum, 4),
         pmold = round(mold_sum/fruit_sum, 4)
         )

### Sum the fruit, BER, eaten, mold, sugar, and mass by treatment group, then get ber, mold, and eaten probability.
#### by plant
d22_f_summary_byplant <- d22_f_omitmassna %>%
  group_by(treatment, plant) %>%
  summarise_at(vars(fruit, ber, eaten, mold, mass),
               list(sum=sum)) %>%
  mutate(pber = round(ber_sum/fruit_sum, 4),
         peaten = round(eaten_sum/fruit_sum, 4),
         pmold = round(mold_sum/fruit_sum, 4)
         )
### Sum the fruit, BER, eaten, mold, sugar, and mass by treatment group, then get ber, mold, and eaten probability.
#### by plant
#### no NA
d22_f_summary_byplant_omitna <- d22_f_omitna %>%
  group_by(treatment, plant) %>%
  summarise_at(vars(fruit, ber, eaten, mold, mass, sugar_grams),
               list(sum=sum)) %>%
  mutate(pber = round(ber_sum/fruit_sum, 4),
         peaten = round(eaten_sum/fruit_sum, 4),
         pmold = round(mold_sum/fruit_sum, 4)
         )

## multispeq
d22_m <- read.csv(d22_m_file)[,c(1,7,9,11,13,14,16,24,30,37,38,44,56,62)] %>%
    rename(Pot = Pot.ID) %>%
  filter(Pot <9, time > cutoff22) %>%
  mutate(Row_num = case_when(
    Row=="A"~1,
    Row=="B"~2,
    Row=="C"~3,
    Row=="D"~4),
    treatment = case_when(
      Row=="A"~"Control",
      Row=="B"~"Salt Stress",
      Row=="C"~"Inoculation",
      Row=="D"~"Salt+Inoc"),
    salt = case_when(
      Row=="A"~FALSE,
      Row=="B"~TRUE,
      Row=="C"~FALSE,
      Row=="D"~TRUE
    ),
    inoculation = case_when(
      Row=="A"~FALSE,
      Row=="B"~FALSE,
      Row=="C"~TRUE,
      Row=="D"~TRUE
    ),
    treatment = factor(treatment, levels = treatment_order22),
    Leaflet.Age = as.factor(Leaflet.Age),
    Plant = as.factor(paste0(Row, Pot)),
    Pot = as.factor(Pot),
    Row = as.factor(Row),
    Device.ID = as.factor(Device.ID),
    Date = as.Date(time, "%m/%d/%Y"),
    time = parse_date_time(time, "%m/%d/%Y %H:%M"),
    Time = format(time, "%H:%M:%S"),
    logitPS2 = logit(Phi2, FALSE),
    logitFvPFmP = logit(FvP_over_FmP, FALSE)
  )
d22_m <- d22_m[,c(1:12,14:23)]
colnames(d22_m) <- tolower(colnames(d22_m))

```

### 1.5.3. 2023 Data Cleaning
```{r 23cleaning}
# 2023
## Fruit Greenhouse (all fruit)
d23_fg <- read.csv(d23_fg_file) %>%
  mutate(
    Row_num = case_when(
     Row=="A"~1,
     Row=="B"~2,
     Row=="C"~3,
     Row=="D"~4),
    Treatment = case_when(
       Row=="A"~"Control",
       Row=="B"~"Soil",
       Row=="C"~"Foliar",
       Row=="D"~"Soil+Foliar",
       TRUE ~ NA),
    soil = case_when(
      Row=="A"~FALSE,
      Row=="B"~TRUE,
      Row=="C"~FALSE,
      Row=="D"~TRUE
    ),
    foliar = case_when(
      Row=="A"~FALSE,
      Row=="B"~FALSE,
      Row=="C"~TRUE,
      Row=="D"~TRUE
    ),
    BER = case_when(
      BER==0~"FALSE",
      BER==1~"TRUE"),
    BER = as.logical(BER),
    Treatment = factor(Treatment, levels = treatment_order23),
    fruit = 1,
    Plant = as.factor(paste0(Row, Pot)),
    Pot = as.factor(Pot),
    Cluster = as.factor(Cluster),
    Date = as.Date(Date, "%m/%d/%Y"),
  )
colnames(d23_fg) <- tolower(colnames(d23_fg))
d23_fg <- d23_fg %>%
  rename(mass = weight)

### Summary Fruit Greenhouse
### Sum the fruit, BER, and mass by treatment group, then get ber probability.
d23_fg_summary <- d23_fg %>%
  group_by(treatment, plant) %>%
  summarise_at(vars(fruit, ber, mass),
               list(sum=sum)) %>%
  mutate(pber = round(ber_sum/fruit_sum, 4))

d23_fg_summary2 <- d23_fg %>%
  group_by(treatment) %>%
  summarise_at(vars(fruit, ber, mass),
               list(sum=sum)) %>%
  mutate(pber = round(ber_sum/fruit_sum, 4))

### Means Fruit Greenhouse
### Make summary dataframe with mean and sd of mass by plant.
d23_fg_means <- d23_fg %>%
  group_by(treatment, plant) %>%
  summarise_at(vars(mass), list(mean=mean, sd=sd))

d23_fg_means2 <- d23_fg %>%
  group_by(treatment) %>%
  summarise_at(vars(mass), list(mean=mean, sd=sd))


## Fruit Lab (no BER; marketable fruit only)
d23_fl <- read.csv(d23_fl_file) %>%
  rename(pot = plant) %>%
  mutate(
    row_num = case_when(
     row=="A"~1,
     row=="B"~2,
     row=="C"~3,
     row=="D"~4),
    Treatment = case_when(row=="A"~"Control",
                               row=="B"~"Soil",
                               row=="C"~"Foliar",
                               row=="D"~"Soil+Foliar",
                               TRUE ~ NA),
    soil = case_when(
      row=="A"~FALSE,
      row=="B"~TRUE,
      row=="C"~FALSE,
      row=="D"~TRUE
    ),
    foliar = case_when(
      row=="A"~FALSE,
      row=="B"~FALSE,
      row=="C"~TRUE,
      row=="D"~TRUE
    ),
    Treatment = factor(Treatment, levels = treatment_order23),
    fruit = 1,
    ripeness = abs(1 - round(penetrometer/max(na.omit(penetrometer)), 2)),
    logit_sugar = logit(sugar_avg/100),
    Sugar_grams = (sugar_avg/100)*mass,
    row = as.factor(row),
    pot = as.factor(pot),
    cluster = as.factor(cluster),
    plant = as.factor(paste0(row, pot)),
    date = as.Date(date, "%m/%d/%Y")
)
colnames(d23_fl) <- tolower(colnames(d23_fl))

### Summary Fruit Lab
### Sum the fruit, sugar, and mass by treatment group.
d23_fl_summary <- d23_fl %>%
  group_by(treatment, plant) %>%
  summarise_at(vars(fruit, sugar_grams, mass),
               list(sum=sum))

d23_fl_summary2 <- d23_fl %>%
  group_by(treatment) %>%
  summarise_at(vars(fruit, sugar_grams, mass),
               list(sum=sum))
### Means Fruit Lab
### Make summary dataframe with mean and sd of mass by plant.
d23_fl_means <- d23_fl %>%
  group_by(treatment, plant) %>%
  summarise_at(vars(mass, sugar_avg, logit_sugar, sugar_grams), list(mean=mean, sd=sd))

d23_fl_means2 <- d23_fl %>%
  group_by(treatment) %>%
  summarise_at(vars(mass, sugar_avg, logit_sugar, sugar_grams), list(mean=mean, sd=sd))

## Li-600
d23_li <- read.csv(d23_li_file, stringsAsFactors = T) %>%
  mutate(Treatment = case_when(
     Row==1~"Control",
     Row==2~"Soil",
     Row==3~"Foliar",
     Row==4~"Soil+Foliar",
            TRUE~NA),
     Row = case_when(
       Row==1~"A",
       Row==2~"B",
       Row==3~"C",
       Row==4~"D"
     ),
    soil = case_when(
      Row=="A"~FALSE,
      Row=="B"~TRUE,
      Row=="C"~FALSE,
      Row=="D"~TRUE
    ),
    foliar = case_when(
      Row=="A"~FALSE,
      Row=="B"~FALSE,
      Row=="C"~TRUE,
      Row=="D"~TRUE
    )) %>%
  filter(leak_pct<10 & gsw > 0) %>%
  rename(Date_ref = Date) %>%
  mutate(Date = parse_date_time(Date_ref, orders = "mdy"),
         Date = as.Date(Date),
         Time = parse_date_time(Time, orders = "T"),
         DaysFromGermination = as.numeric(round(difftime(Date, germdate23, units = c("days")), 0)),
         plant_fac = as.factor(paste0(Row, Pot)),
         Treatment = factor(Treatment, 
                            levels = treatment_order23),
         logitPS2 = logit(PhiPS2, FALSE)
  ) %>%
  group_by(DaysFromGermination) %>%
  mutate(MinutesFromStart = round(difftime(Time, min(Time), units = "mins"), 2)) %>%
  ungroup() %>%
  mutate(
    Time = format(Time, "%H:%M:%S")
  )
d23_li <- d23_li[,c(2,3,7,8,9,16,27,31,33,34,35,36,38,39,61,62,63,64,65,66,67,68)]
colnames(d23_li) <- tolower(colnames(d23_li))

## multispeq
d23_m <- read.csv(d23_m_file)[,c(1,2,3,4,6,7,8,17,23,30,31,37,49,55)] %>%
    rename(Pot = Pot.ID) %>%
    mutate(Treatment = case_when(
     Row=="A"~"Control",
     Row=="B"~"Soil",
     Row=="C"~"Foliar",
     Row=="D"~"Soil+Foliar",
            TRUE~NA),
    soil = case_when(
      Row=="A"~FALSE,
      Row=="B"~TRUE,
      Row=="C"~FALSE,
      Row=="D"~TRUE
    ),
    foliar = case_when(
      Row=="A"~FALSE,
      Row=="B"~FALSE,
      Row=="C"~TRUE,
      Row=="D"~TRUE
    )) %>%
  mutate(Row_num = case_when(
    Row=="A"~1,
    Row=="B"~2,
    Row=="C"~3,
    Row=="D"~4),
    Plant = as.factor(paste0(Row, Pot)),
    Pot = as.factor(Pot),
    Row = as.factor(Row),
    Device.ID = as.factor(Device.ID),
    Date = as.Date(time, "%m/%d/%Y"),
    datetime = parse_date_time(time, "%m/%d/%Y %H:%M"),
    Time = format(datetime, "%H:%M:%S"),
    logitPS2 = logit(Phi2, FALSE),
    logitFvPFmP = logit(FvP_over_FmP, FALSE)
  )
colnames(d23_m) <- tolower(colnames(d23_m))
#### a really weird way to remove the original datetime
d23_m <- d23_m[,c(1:12,14:24)]

## 2023 phips2 joined
d23_ps2_joined <- d23_li %>% mutate(
  Device = "Li600"
) %>% rename(AmbientLight = qamb,
             AmbientPressure = p_atm,
             AmbientHumidity = rh_s,
             AmbientTemperature = tref,
             LeafTemperature = tleaf,
             Plant = plant_fac) %>%
  mutate(AmbientPressure = AmbientPressure * 10)
d23_ps2_joined <- d23_ps2_joined[,c(1,18,15,16,17,19,20,23,8,9,10,11,14,7,21)]

m_temp_23 <- d23_m %>% mutate(
  Device = "MultispeQ",
  daysfromgermination = as.numeric(round(difftime(date, germdate23, units = c("days")), 0))) %>%
  rename(AmbientLight = light.intensity..par.,
             AmbientPressure = ambient.pressure,
             AmbientHumidity = ambient.humidity,
             AmbientTemperature = ambient.temperature,
             LeafTemperature = leaf.temperature,
             phips2 = phi2,
             Plant = plant)
m_temp_23 <- m_temp_23[,c(21,19,14,15,16,25,18,24,5,7,9,6,10,12,22)]

d23_ps2_joined <- rbind(d23_ps2_joined, m_temp_23) %>%
  mutate(Device = as.factor(Device),
         date = as.Date(date))


## stomatal density
d23_st <- read.csv(d23_st_file) %>%
  rename(pot = plant) %>%
  mutate(Treatment = case_when(
     row=="A"~"Control",
     row=="B"~"Soil",
     row=="C"~"Foliar",
     row=="D"~"Soil+Foliar",
            TRUE~NA),
    soil = case_when(
      row=="A"~FALSE,
      row=="B"~TRUE,
      row=="C"~FALSE,
      row=="D"~TRUE
    ),
    foliar = case_when(
      row=="A"~FALSE,
      row=="B"~FALSE,
      row=="C"~TRUE,
      row=="D"~TRUE
    ),
    plant = as.factor(paste0(row, pot)),
    surface = as.factor(surface)
)
colnames(d23_st) <- tolower(colnames(d23_st))
```

### 1.5.4. 2024 Data Cleaning
```{r 24cleaning}
# 2024
## fruit
d24_f <- read.csv(d24_f_file) %>%
  filter(mass>0)%>%
  rename(pot = plant) %>%
  mutate(row = case_when(
    row==1~"A",
    row==2~"B",
    row==3~"C",
    row==4~"D"),
    treatment = case_when(
      row=="A"~"Control",
      row=="B"~"Transplantation",
      row=="C"~"Germination",
      row=="D"~"Germ+Trans",
      TRUE~NA),
    transplantation = case_when(
      row=="A"~FALSE,
      row=="B"~TRUE,
      row=="C"~FALSE,
      row=="D"~TRUE
    ),
    germination = case_when(
      row=="A"~FALSE,
      row=="B"~FALSE,
      row=="C"~TRUE,
      row=="D"~TRUE
    ),
    fruit = 1,
    date_analysis = parse_date_time(date_analysis, orders = "mdy"),
    date_harvest = parse_date_time(date_harvest, orders = "mdy"),
    daysfromharvesttoanalysis = as.numeric(round(difftime(date_analysis, date_harvest, units = c("days")), 0)),
    daysfromgermination = as.numeric(round(difftime(date_analysis, germdate24, units = c("days")), 0)),
    plant = as.factor(paste0(row, pot)),
    pot = as.factor(pot),
    treatment = factor(treatment, levels = treatment_order24),
    plant = factor(plant, levels = plant_order24),
    BER = as.logical(BER),
    fungus = as.logical(fungus),
    cracking = as.logical(cracking),
    ripeness = abs(1 - round(penetrometer/max(na.omit(penetrometer)), 2)),
    sugar_grams = (sugar_avg/100)*mass
  )
colnames(d24_f) <- tolower(colnames(d24_f))

d24_f_export <- d24_f[,-c(8,9)]

### Make summary dataframe with mean and sd of mass and sugar by plant.
d24_f_means <- na.omit(d24_f) %>%
  group_by(treatment, plant) %>%
  summarise_at(vars(mass, sugar_avg, sugar_grams), list(mean=mean, sd=sd))

d24_f_means2 <- na.omit(d24_f) %>%
  group_by(treatment) %>%
  summarise_at(vars(mass, sugar_avg, sugar_grams), list(mean=mean, sd=sd))

### Sum the fruit, BER, sugar, and mass by treatment group, then get ber probability.
d24_f_summary <- d24_f %>%
  group_by(treatment, germination, transplantation, plant) %>%
  summarise_at(vars(fruit, ber, fungus, cracking, mass), list(sum=sum)) %>%
  mutate(pber = round(ber_sum/fruit_sum, 4),
         pfungus = round(fungus_sum/fruit_sum, 4),
         pcracking = round(cracking_sum/fruit_sum, 4)
         )

d24_f_summary2 <- d24_f %>%
  group_by(treatment) %>%
  summarise_at(vars(fruit, ber, fungus, cracking, mass), list(sum=sum)) %>%
  mutate(pber = round(ber_sum/fruit_sum, 4),
         pfungus = round(fungus_sum/fruit_sum, 4),
         pcracking = round(cracking_sum/fruit_sum, 4)
         )

### sugar summary
d24_f_summary_sugar <- na.omit(d24_f) %>%
  group_by(treatment, plant, germination, transplantation) %>%
  summarise_at(vars(fruit, mass, sugar_grams), list(sum=sum))


## Li-600
d24_li <- read.csv(d24_li_file, stringsAsFactors = F) %>%
  mutate(row_let = case_when(
    Row==1~"A",
    Row==2~"B",
    Row==3~"C",
    Row==4~"D"),
  Treatment = case_when(
     Row==1~"Control",
     Row==2~"Transplantation",
     Row==3~"Germination",
     Row==4~"Germ+Trans",
            TRUE~NA),
      transplantation = case_when(
      row_let=="A"~FALSE,
      row_let=="B"~TRUE,
      row_let=="C"~FALSE,
      row_let=="D"~TRUE
    ),
    germination = case_when(
      row_let=="A"~FALSE,
      row_let=="B"~FALSE,
      row_let=="C"~TRUE,
      row_let=="D"~TRUE
    )) %>%
  filter(leak_pct<10) %>%
  rename(Date_ref = Date) %>%
  mutate(Date = parse_date_time(Date_ref, orders = "mdy"),
         Time = parse_date_time(Time, orders = "T"),
         DaysFromGermination = as.numeric(round(difftime(Date, germdate24, units = c("days")), 0)),
         plant = as.factor(paste0(row_let, Pot)),
         plant = factor(plant, levels = plant_order24),
         Treatment = factor(Treatment, 
                            levels = treatment_order24),
         logitPS2 = logit(PhiPS2, FALSE)
  ) %>%
  group_by(DaysFromGermination) %>%
  mutate(MinutesFromStart = round(difftime(Time, min(Time), units = "mins"), 2)) %>%
  ungroup() %>%
  mutate(
    Time = format(Time, "%H:%M:%S")
  )
d24_li <- d24_li[,c(2,3,7,8,10,17,28,32,34,35,36,39,40,114,115,116,117,118,119,120,121,122)]
colnames(d24_li) <- tolower(colnames(d24_li))

d24_li_export <- d24_li[,-c(2,3)] %>%
  mutate(pot = as.factor(pot))

## multispeq
d24_m <- read.csv(d24_m_file) %>%
    mutate(Treatment = case_when(
     Row=="A"~"Control",
     Row=="B"~"Transplantation",
     Row=="C"~"Germination",
     Row=="D"~"Germ+Trans",
            TRUE~NA),
    transplantation = case_when(
      Row=="A"~FALSE,
      Row=="B"~TRUE,
      Row=="C"~FALSE,
      Row=="D"~TRUE
    ),
    germination = case_when(
      Row=="A"~FALSE,
      Row=="B"~FALSE,
      Row=="C"~TRUE,
      Row=="D"~TRUE
    )) %>%
  mutate(Row_num = case_when(
    Row=="A"~1,
    Row=="B"~2,
    Row=="C"~3,
    Row=="D"~4),
    Plant = as.factor(paste0(Row, Pot)),
    Plant = factor(Plant, levels = plant_order24),
    Pot = as.factor(Pot),
    Row = as.factor(Row),
    Device.ID = as.factor(Device.ID),
    Date = as.Date(time, "%m/%d/%Y"),
    time = parse_date_time(time, "%m/%d/%Y %H:%M"),
    Time = format(time, "%H:%M:%S"),
    logitPS2 = logit(Phi2, FALSE),
    logitFvPFmP = logit(FvP_over_FmP, FALSE)
  )
d24_m <- d24_m[,c(1,4,5,6,7,8,10,11,12,21,27,30,34,35,41,59,63,64,65,66,67,68,69,70,71)]
colnames(d24_m) <- tolower(colnames(d24_m))


d24_ps2_joined <- d24_li %>% mutate(
  Device = "Li600"
) %>% rename(AmbientLight = qamb,
             AmbientPressure = p_atm,
             AmbientHumidity = rh_s,
             AmbientTemperature = tref,
             LeafTemperature = tleaf,
             Plant = plant) %>%
  mutate(AmbientPressure = AmbientPressure * 10)
d24_ps2_joined <- d24_ps2_joined[,c(1,18,15,16,17,19,20,23,8,9,10,11,13,7,21)]

m_temp <- d24_m %>% mutate(
  Device = "MultispeQ",
  daysfromgermination = as.numeric(round(difftime(date, germdate24, units = c("days")), 0))) %>%
  rename(AmbientLight = light.intensity..par.,
             AmbientPressure = ambient.pressure,
             AmbientHumidity = ambient.humidity,
             AmbientTemperature = ambient.temperature,
             LeafTemperature = leaf.temperature,
             phips2 = phi2,
             Plant = plant)
m_temp <- m_temp[,c(23,22,17,18,19,27,21,26,7,9,11,8,13,15,24)]

d24_ps2_joined <- rbind(d24_ps2_joined, m_temp) %>%
  mutate(Device = as.factor(Device),
         date = as.Date(date))

```


# 2. Analysis

## 2.1. 2021 Analysis

### 2.1.1. 2021 Exploratory Analysis
```{r 21exploratory}

# power analysis
## 2021 had 4 groups, 7 replicates per group, effect size 0.25
pwr21 <- round(pwr.anova.test(k=4, n=7, f=0.25, sig.level=0.5)$power, 4)

# fruit
## mass
### PDF, CDF, and KS test
multipdf_plot(d21_f$mass, 100, "all", a_palette)
ggsave("21mass_PDF.svg", path = "C:/Github/Thesis/figures/TIP21")
multicdf_plot(d21_f$mass, 100, "all", a_palette)
ggsave("21mass_CDF.svg", path = "C:/Github/Thesis/figures/TIP21")

multiks_cont(d21_f$mass, "all")

## check for heteroscedasticity
### in mass as a function of treatment
leveneTest(d21_f$mass~d21_f$treatment)
### in mass as a function of ber
leveneTest(d21_f$mass~d21_f$ber)

## box plot by Treatment
ggplot(data = d21_f, aes(x= treatment, y = mass, 
                         fill=treatment, color=treatment)) +
  geom_boxplot(alpha=.5, width=0.5, outliers = FALSE)+
  geom_jitter( width=.15, height=0)+
  scale_fill_manual(values=four_colors)+
  scale_color_manual(values=four_colors)+
  labs(
    title="Fruit Mass by Inoculation Treatments in Tomato"
  ) +
  ylab("Mass (g)")+
  xlab("Treatment")+
  theme_bw()+
  theme(
    legend.position="none",
    text = element_text(size=subtitle_size, family="mont", lineheight=0.8),
    axis.title = element_text(size=subtitle_size, family = "mont", face= "bold"),
    title = element_text(size=title_size, family="open", face="bold")
  )

## box plot by Treatment colored by BER
ggplot(data = d21_f, aes(x= treatment, y = mass, 
                         fill=ber, color=ber)) +
  geom_boxplot(alpha=.5, width=0.6, outliers = TRUE)+
  scale_fill_manual(values=two_colors)+
  scale_color_manual(values=two_colors)+
  guides(fill=guide_legend(title=str_wrap("Blossom-End Rot", 10)),
         color=guide_legend(title=str_wrap("Blossom-End Rot", 10))
         )+
  labs(
    title="Fruit Mass by Blossom-End Rot and Inoculation Treatments in Tomato"
  ) +
  ylab("Mass (g)")+
  xlab("Treatment")+
  theme_bw()+
  theme(
    legend.position="right",
    legend.title = element_text(size=subtitle_size, family="mont",
                                face = "bold", lineheight=0.5),
    text = element_text(size=subtitle_size, family="mont", lineheight=0.8),
    axis.title = element_text(size=subtitle_size, family = "mont", face= "bold"),
    title = element_text(size=title_size, family="open", face="bold")
  )

## summarized fruit graphs
### box plot of mean mass by treatment
ggplot(data = d21_f_means, aes(x= treatment, y = mean, 
                         fill=treatment, color=treatment)) +
  geom_boxplot(alpha=.5, width=0.5, outliers = FALSE)+
  geom_jitter( width=.15, height=0)+
  scale_fill_manual(values=four_colors)+
  scale_color_manual(values=four_colors)+
  labs(
    title="Mean Fruit Mass by Inoculation Treatments in Tomato Plants"
  ) +
  ylab("Mass (g)")+
  xlab("Treatment")+
  theme_bw()+
  theme(
    legend.position="none",
    text = element_text(size=subtitle_size, family="mont", lineheight=0.8),
    axis.title = element_text(size=subtitle_size, family = "mont", face= "bold"),
    title = element_text(size=title_size, family="open", face="bold")
  )

### box plot of percent BER by treatment
ggplot(data = d21_f_summary_byplant, aes(x= treatment, y = pber, 
                         fill=treatment, color=treatment)) +
  geom_boxplot(alpha=.5, width=0.5, outliers = FALSE)+
  geom_jitter( width=.15, height=0)+
  scale_fill_manual(values=four_colors)+
  scale_color_manual(values=four_colors)+
  labs(
    title=str_wrap("Proportion BER by Inoculation Treatments in Tomato Plants", 40)
  ) +
  ylab("pBER")+
  xlab("Treatment")+
  theme_bw()+
  theme(
    legend.position="none",
    text = element_text(size=subtitle_size, family="mont", lineheight=0.8),
    axis.title = element_text(size=subtitle_size, family = "mont", face= "bold"),
    title = element_text(size=title_size, family="open", face="bold")
  )
ggsave("21pBER.svg", path = "C:/Github/Thesis/figures/TIP21")


### box plot of total fruit mass by treatment
ggplot(data = d21_f_summary_byplant, aes(x= treatment, y = mass_sum, 
                         fill=treatment, color=treatment)) +
  geom_boxplot(alpha=.5, width=0.5, outliers = FALSE)+
  geom_jitter( width=.15, height=0)+
  scale_fill_manual(values=four_colors)+
  scale_color_manual(values=four_colors)+
  labs(
    tag="2021",
    title=str_wrap("Total Fruit Mass by Inoculation Treatments in Tomato Plants", 40)
  ) +
  ylab("Mass (g)")+
  xlab("Treatment")+
  theme_bw()+
  theme(
    legend.position="none",
    text = element_text(size=subtitle_size, family="mont", lineheight=0.8),
    axis.title = element_text(size=subtitle_size, family = "mont", face= "bold"),
    title = element_text(size=title_size, family="open", face="bold")
  )
ggsave("21totalfruitmass.svg", path = "C:/Github/Thesis/figures/TIP21")


### box plot of total fruit count by treatment
ggplot(data = d21_f_summary_byplant, aes(x= treatment, y = fruitnumber_sum, 
                         fill=treatment, color=treatment)) +
  geom_boxplot(alpha=.5, width=0.5, outliers = FALSE)+
  geom_jitter( width=.15, height=0)+
  scale_fill_manual(values=four_colors)+
  scale_color_manual(values=four_colors)+
  labs(
    tag="2021",
    title=str_wrap("Total Fruit Count by Inoculation Treatments in Tomato Plants", 40)
  ) +
  ylab("Fruit")+
  xlab("Treatment")+
  theme_bw()+
  theme(
    legend.position="none",
    text = element_text(size=subtitle_size, family="mont", lineheight=0.8),
    axis.title = element_text(size=subtitle_size, family = "mont", face= "bold"),
    title = element_text(size=title_size, family="open", face="bold")
  )
ggsave("21totalfruitcount.svg", path = "C:/Github/Thesis/figures/TIP21")

# multispeq
## phiPS2
### PDF, CDF, and KS test
multipdf_plot(d21_m$phi2, 100, "all", a_palette, "PhiPS2")+
  labs(tag="2021")
ggsave("21phi2_PDF.svg", path = "C:/Github/Thesis/figures/TIP21")
multicdf_plot(d21_m$phi2, 100, "all", a_palette, "PhiPS2")+
  labs(tag="2021")
ggsave("21phi2_CDF.svg", path = "C:/Github/Thesis/figures/TIP21")
multiks_cont(d21_m$phi2, "all")

### check for heteroscedasticity
###### Pr(>F) of < 0.05 means that the value is homoscedastic
leveneTest(d21_m$phi2~d21_m$treatment)
leveneTest(d21_m$logitps2~d21_m$treatment)

### box plot of logit PhiPS2 by treatment
ggplot(data = d21_m, aes(x= treatment, y = logitps2, 
                         fill=treatment, color=treatment)) +
  geom_boxplot(alpha=.5, width=0.5, outliers = FALSE)+
  geom_jitter( width=.15, height=0)+
  scale_fill_manual(values=four_colors)+
  scale_color_manual(values=four_colors)+
  labs(
    tag="2021",
    title="Logit PhiPS2 by Inoculation Treatments in Tomato"
  ) +
  ylab("PhiPS2")+
  xlab("Treatment")+
  theme_bw()+
  theme(
    legend.position="none",
    text = element_text(size=subtitle_size, family="mont", lineheight=0.8),
    axis.title = element_text(size=subtitle_size, family = "mont", face= "bold"),
    title = element_text(size=title_size, family="open", face="bold")
  )

### logit PhiPS2 by date scatterplot
ggplot(data = d21_m, aes(x= date, y = phi2, 
                         fill=treatment, color=treatment,
                         shape = device.id)) +
  geom_jitter( width=2, height=0)+
  scale_fill_manual(values=four_colors)+
  scale_color_manual(values=four_colors)+
  labs(
    tag="2021",
    title="PhiPS2 by Date and Inoculation Treatments in Tomato"
  ) +
  ylab("PhiPS2")+
  xlab("Date")+
  theme_bw()+
  theme(
    legend.position="right",
    text = element_text(size=subtitle_size, family="mont", lineheight=0.8),
    axis.title = element_text(size=subtitle_size, family = "mont", face= "bold"),
    title = element_text(size=title_size, family="open", face="bold")
  )

### logit PhiPS2 by time scatterplot
ggplot(data = d21_m, aes(x= time, y = phi2, 
                         fill=treatment, color=treatment,
                         shape = device.id)) +
  geom_jitter( width=0, height=0)+
  scale_fill_manual(values=four_colors)+
  scale_color_manual(values=four_colors)+
  scale_x_discrete(guide=guide_axis(check.overlap=TRUE))+
  labs(
    tag="2021",
    title="PhiPS2 by Time and Inoculation Treatments in Tomato"
  ) +
  ylab("PhiPS2")+
  xlab("Time")+
  theme_bw()+
  theme(
    legend.position="right",
    text = element_text(size=subtitle_size, family="mont", lineheight=0.8),
    axis.title = element_text(size=subtitle_size, family = "mont", face= "bold"),
    title = element_text(size=title_size, family="open", face="bold")
  )

### logit PhiPS2 by time scatterplot
ggplot(data = d21_m, aes(x= ambient.temperature, y = phi2, 
                         fill=treatment, color=treatment,
                         shape = device.id)) +
  geom_jitter( width=0, height=0)+
  scale_fill_manual(values=four_colors)+
  scale_color_manual(values=four_colors)+
  labs(
    tag="2021",
    title=str_wrap("PhiPS2 by Ambient Temperature Over Treatments in Tomato", 40)
  ) +
  ylab("PhiPS2")+
  xlab("Ambient Temperature (C°)")+
  theme_bw()+
  theme(
    legend.position="right",
    text = element_text(size=subtitle_size, family="mont", lineheight=0.8),
    axis.title = element_text(size=subtitle_size, family = "mont", face= "bold"),
    title = element_text(size=title_size, family="open", face="bold")
  )
ggsave("21_phi2bytemp.svg", path = "C:/Github/Thesis/figures/TIP21")

```
### 2.1.2. 2021 Models and Post Hoc Analysis

Models for fruit mass, PhiPS2
```{r 21models}
# fruit
## mass 
d21_f_m_lm <- lm(log(mean) ~ treatment, data=d21_f_means)
AIC(d21_f_m_lm)
summary(d21_f_m_lm)
##### post hoc comparisons
comps <- glht(d21_f_m_lm, linfct = mcp(treatment = "Tukey"))
d21_f_m_lm_letters <- cld(comps)$mcletters$Letters
print(d21_f_m_lm_letters)

ggplot(data = d21_f_means, aes(x= treatment, y = mean, 
                         fill=treatment, color=treatment)) +
  geom_boxplot(alpha=.5, width=0.5, outliers = FALSE)+
  geom_jitter( width=.15, height=0)+
  scale_fill_manual(values=four_colors)+
  scale_color_manual(values=four_colors)+
  labs(
    tag="2021",
    title="Mean Fruit Mass by Inoculation Treatments in Tomato Plants"
  ) +
  annotate("text", x=1:4, y=130, label = d21_f_m_lm_letters, size=10, family="open")+
  ylab("Mass (g)")+
  xlab("Treatment")+
  theme_bw()+
  theme(
    legend.position="none",
    text = element_text(size=subtitle_size, family="mont", lineheight=0.8),
    axis.title = element_text(size=subtitle_size, family = "mont", face= "bold"),
    title = element_text(size=title_size, family="open", face="bold")
  )
ggsave("21_mass_box_annotated.svg", path = "C:/Github/Thesis/figures/TIP21",
       width = 8, height = 6)

## fruit count
d21_f_fc_lm <- lm(fruitnumber_sum ~ treatment, data = d21_f_summary_byplant)
AIC(d21_f_fc_lm)
summary(d21_f_fc_lm)
##### post hoc comparisons
comps <- glht(d21_f_fc_lm, linfct = mcp(treatment = "Tukey"))
d21_f_fc_lm_letters <- cld(comps)$mcletters$Letters
print(d21_f_fc_lm_letters)

## pBER
d21_f_pber_lm <- lm(logit(pber) ~ treatment, data = d21_f_summary_byplant)
AIC(d21_f_pber_lm)
summary(d21_f_pber_lm)
##### post hoc comparisons
comps <- glht(d21_f_pber_lm, linfct = mcp(treatment = "Tukey"))
d21_f_pber_lm_letters <- cld(comps)$mcletters$Letters
print(d21_f_pber_lm_letters)

ggplot(data = d21_f_summary_byplant, aes(x= treatment, y = pber, 
                         fill=treatment, color=treatment)) +
  geom_boxplot(alpha=.5, width=0.5, outliers = FALSE)+
  geom_jitter( width=.15, height=0)+
  scale_fill_manual(values=four_colors)+
  scale_color_manual(values=four_colors)+
  labs(
    tag="2021",
    title=str_wrap("Proportion BER by Inoculation Treatments in Tomato Plants", 40)
  ) +
  annotate("text", x=1:4, y=.55, label = d21_f_pber_lm_letters, size=10, family="open")+
  ylab("pBER")+
  xlab("Treatment")+
  theme_bw()+
  theme(
    legend.position="none",
    text = element_text(size=subtitle_size, family="mont", lineheight=0.8),
    axis.title = element_text(size=subtitle_size, family = "mont", face= "bold"),
    title = element_text(size=title_size, family="open", face="bold")
  )
ggsave("21_pber_box_annotated.svg", path = "C:/Github/Thesis/figures/TIP21",
       width = 8, height = 6)

# multispeq
## PhiPS2
d21_m_lm <- lm(logit(phi2) ~ treatment + ambient.humidity, data = d21_m)
AIC(d21_m_lm)
summary(d21_m_lm)
##### post hoc comparisons
comps <- glht(d21_m_lm, linfct = mcp(treatment = "Tukey"))
d21_m_lm_letters <- cld(comps)$mcletters$Letters
print(d21_m_lm_letters)
predict_plot(d21_m_lm, d21_m, phi2, ambient.humidity, treatment,
             interval = "confidence", correction = "logit")+
  labs(tag = "2021")+
  ylab("PhiPS2")+
  xlab("Ambient Humidity (%)")+
  guides(fill=guide_legend(title="Treatment"),
         color=guide_legend(title="Treatment"))+
  scale_color_scico_d(begin = 0.9, end = 0.1, palette = a_palette)+
  scale_fill_scico_d(begin = 0.9, end = 0.1, palette = a_palette)
ggsave("21_phi2_pred_CI.svg", path = "C:/Github/Thesis/figures/TIP21",
       width = 10, height = 6)
```

## 2.2. 2022 Analysis

### 2.2.1. 2022 Exploratory Analysis
```{r 22exploratory}
# fruit
## mass
### PDF, CDF, and KS test
multipdf_plot(d22_f_omitmassna$mass, 100, "all", a_palette, "mass")+
  labs(tag="2022")
ggsave("22mass_PDF.svg", path = "C:/Github/Thesis/figures/TIP22")
multicdf_plot(d22_f_omitmassna$mass, 100, "all", a_palette, "mass")+
  labs(tag="2022")
ggsave("22mass_CDF.svg", path = "C:/Github/Thesis/figures/TIP22")
multiks_cont(d22_f_omitmassna$mass, "all")

## check for heteroscedasticity
### in mass as a function of treatment
leveneTest(d22_f_omitmassna$mass~d22_f_omitmassna$treatment)
### in mass as a function of ber
leveneTest(d22_f_omitmassna$mass~d22_f_omitmassna$ber)

## box plot of mass by Treatment
ggplot(data = d22_f_omitmassna, aes(x= treatment, y = mass, 
                         fill=treatment, color=treatment)) +
  geom_boxplot(alpha=.5, width=0.5, outliers = FALSE)+
  geom_jitter( width=.15, height=0)+
  scale_fill_manual(values=four_colors)+
  scale_color_manual(values=four_colors)+
  labs(
    tag = "2022",
    title="Fruit Mass by Inoculation Treatments in Tomato"
  ) +
  ylab("Mass (g)")+
  xlab("Treatment")+
  theme_bw()+
  theme(
    legend.position="none",
    text = element_text(size=subtitle_size, family="mont", lineheight=0.8),
    axis.title = element_text(size=subtitle_size, family = "mont", face= "bold"),
    title = element_text(size=title_size, family="open", face="bold")
  )

## box plot by Treatment colored by BER
ggplot(data = d22_f_omitmassna, aes(x= treatment, y = mass, 
                         fill=ber, color=ber)) +
  geom_boxplot(alpha=.5, width=0.6, outliers = TRUE)+
  scale_fill_manual(values=two_colors)+
  scale_color_manual(values=two_colors)+
  guides(fill=guide_legend(title=str_wrap("Blossom-End Rot", 10)),
         color=guide_legend(title=str_wrap("Blossom-End Rot", 10))
         )+
  labs(
    tag = "2022",
    title="Fruit Mass by Blossom-End Rot and Inoculation Treatments in Tomato"
  ) +
  ylab("Mass (g)")+
  xlab("Treatment")+
  theme_bw()+
  theme(
    legend.position="right",
    legend.title = element_text(size=subtitle_size, family="mont",
                                face = "bold", lineheight=0.5),
    text = element_text(size=subtitle_size, family="mont", lineheight=0.8),
    axis.title = element_text(size=subtitle_size, family = "mont", face= "bold"),
    title = element_text(size=title_size, family="open", face="bold")
  )
ggsave("22mass_BER.svg", path = "C:/Github/Thesis/figures/TIP22")

## summarized fruit graphs
### box plot of mean mass of ALL tomatoes by treatment
ggplot(data = d22_f_means_omitna, aes(x= treatment, y = mass_mean, 
                         fill=treatment, color=treatment)) +
  geom_boxplot(alpha=.5, width=0.5, outliers = FALSE)+
  geom_jitter( width=.15, height=0)+
  scale_fill_manual(values=four_colors)+
  scale_color_manual(values=four_colors)+
  labs(
    tag="2022",
    title="Mean Fruit Mass by Inoculation Treatments in Tomato Plants"
  ) +
  ylab("Mass (g)")+
  xlab("Treatment")+
  theme_bw()+
  theme(
    legend.position="none",
    text = element_text(size=subtitle_size, family="mont", lineheight=0.8),
    axis.title = element_text(size=subtitle_size, family = "mont", face= "bold"),
    title = element_text(size=title_size, family="open", face="bold")
  )

### box plot of mean mass of sugar measurement tomatoes by treatment
ggplot(data = d22_f_means_omitna, aes(x= treatment, y = mass_mean, 
                         fill=treatment, color=treatment)) +
  geom_boxplot(alpha=.5, width=0.5, outliers = FALSE)+
  geom_jitter( width=.15, height=0)+
  scale_fill_manual(values=four_colors)+
  scale_color_manual(values=four_colors)+
  labs(
    tag="2022",
    title= str_wrap("Mean Fruit Mass In Fruit Analyzed for Sugar by Inoculation Treatments in Tomato Plants", 60)
  ) +
  ylab("Mass (g)")+
  xlab("Treatment")+
  theme_bw()+
  theme(
    legend.position="none",
    text = element_text(size=subtitle_size, family="mont", lineheight=0.8),
    axis.title = element_text(size=subtitle_size, family = "mont", face= "bold"),
    title = element_text(size=title_size, family="open", face="bold")
  )

### box plot of percent BER by treatment
ggplot(data = d22_f_summary_byplant, aes(x= treatment, y = pber, 
                         fill=treatment, color=treatment)) +
  geom_boxplot(alpha=.5, width=0.5, outliers = FALSE)+
  geom_jitter( width=.15, height=0)+
  scale_fill_manual(values=four_colors)+
  scale_color_manual(values=four_colors)+
  labs(
    tag="2022",
    title="Proportion BER by Inoculation Treatment in Tomato Plants"
  ) +
  ylab("pBER")+
  xlab("Treatment")+
  theme_bw()+
  theme(
    legend.position="none",
    text = element_text(size=subtitle_size, family="mont", lineheight=0.8),
    axis.title = element_text(size=subtitle_size, family = "mont", face= "bold"),
    title = element_text(size=title_size, family="open", face="bold")
  )

### box plot of percent mold by treatment
ggplot(data = d22_f_summary_byplant, aes(x= treatment, y = pmold, 
                         fill=treatment, color=treatment)) +
  geom_boxplot(alpha=.5, width=0.5, outliers = FALSE)+
  geom_jitter( width=.15, height=0)+
  scale_fill_manual(values=four_colors)+
  scale_color_manual(values=four_colors)+
  labs(
    tag="2022",
    title="Proportion Mold by Inoculation Treatment in Tomato Plants"
  ) +
  ylab("pMold")+
  xlab("Treatment")+
  theme_bw()+
  theme(
    legend.position="none",
    text = element_text(size=subtitle_size, family="mont", lineheight=0.8),
    axis.title = element_text(size=subtitle_size, family = "mont", face= "bold"),
    title = element_text(size=title_size, family="open", face="bold")
  )

### box plot of percent mold by treatment
ggplot(data = d22_f_summary_byplant, aes(x= treatment, y = peaten, 
                         fill=treatment, color=treatment)) +
  geom_boxplot(alpha=.5, width=0.5, outliers = FALSE)+
  geom_jitter( width=.15, height=0)+
  scale_fill_manual(values=four_colors)+
  scale_color_manual(values=four_colors)+
  labs(
    tag="2022",
    title="Proportion Eaten by Inoculation Treatment in Tomato Plants"
  ) +
  ylab("pEaten")+
  xlab("Treatment")+
  theme_bw()+
  theme(
    legend.position="none",
    text = element_text(size=subtitle_size, family="mont", lineheight=0.8),
    axis.title = element_text(size=subtitle_size, family = "mont", face= "bold"),
    title = element_text(size=title_size, family="open", face="bold")
  )

ggplot(data = d22_f_summary_byplant, aes(x= treatment, y = mass_sum, 
                         fill=treatment, color=treatment)) +
  geom_boxplot(alpha=.5, width=0.5, outliers = FALSE)+
  geom_jitter( width=.15, height=0)+
  scale_fill_manual(values=four_colors)+
  scale_color_manual(values=four_colors)+
  labs(
    tag="2022",
    title="Total Fruit Mass by Inoculation Treatment in Tomato Plants"
  ) +
  ylab("Mass (g)")+
  xlab("Treatment")+
  theme_bw()+
  theme(
    legend.position="none",
    text = element_text(size=subtitle_size, family="mont", lineheight=0.8),
    axis.title = element_text(size=subtitle_size, family = "mont", face= "bold"),
    title = element_text(size=title_size, family="open", face="bold")
  )

ggplot(data = d22_f_summary_byplant, aes(x= treatment, y = fruit_sum, 
                         fill=treatment, color=treatment)) +
  geom_boxplot(alpha=.5, width=0.5, outliers = FALSE)+
  geom_jitter( width=.15, height=0)+
  scale_fill_manual(values=four_colors)+
  scale_color_manual(values=four_colors)+
  labs(
    tag="2022",
    title="Total Fruit Count by Inoculation Treatment in Tomato Plants"
  ) +
  ylab("Fruit")+
  xlab("Treatment")+
  theme_bw()+
  theme(
    legend.position="none",
    text = element_text(size=subtitle_size, family="mont", lineheight=0.8),
    axis.title = element_text(size=subtitle_size, family = "mont", face= "bold"),
    title = element_text(size=title_size, family="open", face="bold")
  )
ggsave("22fruit_count.svg", path = "C:/Github/Thesis/figures/TIP22")

## sugar
### PDF, CDF, and KS test
multipdf_plot(d22_f_omitna$sugar_grams, 100, "all", a_palette, "sugar")+
  labs(tag="2022")
ggsave("22sugar_PDF.svg", path = "C:/Github/Thesis/figures/TIP22")
multicdf_plot(d22_f_omitna$sugar_grams, 100, "all", a_palette, "sugar")+
  labs(tag="2022")
ggsave("22sugar_CDF.svg", path = "C:/Github/Thesis/figures/TIP22")
multiks_cont(d22_f_omitna$sugar_grams, "all")

## check for heteroscedasticity
### in mass as a function of treatment
leveneTest(d22_f_omitna$sugar_grams~d22_f_omitna$treatment)
### in mass as a function of ber
leveneTest(d22_f_omitna$sugar_grams~d22_f_omitna$ber)
###### NOT homoscedastic! Unequal variances!

## box plot of sugar % by Treatment
ggplot(data = d22_f_omitna, aes(x= treatment, y = sugar_avg, 
                         fill=treatment, color=treatment)) +
  geom_boxplot(alpha=.5, width=0.5, outliers = FALSE)+
  geom_jitter( width=.15, height=0)+
  scale_fill_manual(values=four_colors)+
  scale_color_manual(values=four_colors)+
  labs(
    tag = "2022",
    title="Sugar % by Inoculation Treatment in Tomato"
  ) +
  ylab("Sugar %")+
  xlab("Treatment")+
  theme_bw()+
  theme(
    legend.position="none",
    text = element_text(size=subtitle_size, family="mont", lineheight=0.8),
    axis.title = element_text(size=subtitle_size, family = "mont", face= "bold"),
    title = element_text(size=title_size, family="open", face="bold")
  )

## box plot of sugar by Treatment
ggplot(data = d22_f_omitna, aes(x= treatment, y = sugar_grams, 
                         fill=treatment, color=treatment)) +
  geom_boxplot(alpha=.5, width=0.5, outliers = FALSE)+
  geom_jitter( width=.15, height=0)+
  scale_fill_manual(values=four_colors)+
  scale_color_manual(values=four_colors)+
  labs(
    tag = "2022",
    title="Sugar Mass by Inoculation Treatment in Tomato"
  ) +
  ylab("Sugar (g)")+
  xlab("Treatment")+
  theme_bw()+
  theme(
    legend.position="none",
    text = element_text(size=subtitle_size, family="mont", lineheight=0.8),
    axis.title = element_text(size=subtitle_size, family = "mont", face= "bold"),
    title = element_text(size=title_size, family="open", face="bold")
  )

## scatter plot of sugar by mass
ggplot(data = d22_f_omitna, aes(x= mass, y = sugar_avg, 
                         fill=treatment, color=treatment)) +
  geom_jitter( width=0, height=0)+
  scale_fill_manual(values=four_colors)+
  scale_color_manual(values=four_colors)+
  labs(
    tag = "2022",
    title="Sugar by Mass in Inoculated, Salt-Stressed Tomato"
  ) +
  ylab("Sugar %")+
  xlab("Mass (g)")+
  theme_bw()+
  theme(
    legend.position="right",
    text = element_text(size=subtitle_size, family="mont", lineheight=0.8),
    axis.title = element_text(size=subtitle_size, family = "mont", face= "bold"),
    title = element_text(size=title_size, family="open", face="bold")
  )
ggsave("22sugar_by_mass.svg", path = "C:/Github/Thesis/figures/TIP22",
       width = 10, height = 8)


## box plot of mean sugar by Treatment
ggplot(data = d22_f_means_omitna, aes(x= treatment, y = sugar_avg_mean, 
                         fill=treatment, color=treatment)) +
  geom_boxplot(alpha=.5, width=0.5, outliers = FALSE)+
  geom_jitter( width=.15, height=0)+
  scale_fill_manual(values=four_colors)+
  scale_color_manual(values=four_colors)+
  labs(
    tag = "2022",
    title="Mean Sugar % by Inoculation Treatment in Tomato"
  ) +
  ylab("Sugar %")+
  xlab("Treatment")+
  theme_bw()+
  theme(
    legend.position="none",
    text = element_text(size=subtitle_size, family="mont", lineheight=0.8),
    axis.title = element_text(size=subtitle_size, family = "mont", face= "bold"),
    title = element_text(size=title_size, family="open", face="bold")
  )
ggsave("22sugar_mean_box.svg", path = "C:/Github/Thesis/figures/TIP22")


## box plot of total sugar by Treatment
ggplot(data = d22_f_summary_byplant_omitna, aes(x= treatment, y = sugar_grams_sum, 
                         fill=treatment, color=treatment)) +
  geom_boxplot(alpha=.5, width=0.5, outliers = FALSE)+
  geom_jitter( width=.15, height=0)+
  scale_fill_manual(values=four_colors)+
  scale_color_manual(values=four_colors)+
  labs(
    tag = "2022",
    title="Total Sugar Mass by Inoculation Treatment in Tomato"
  ) +
  ylab("Sugar (g)")+
  xlab("Treatment")+
  theme_bw()+
  theme(
    legend.position="none",
    text = element_text(size=subtitle_size, family="mont", lineheight=0.8),
    axis.title = element_text(size=subtitle_size, family = "mont", face= "bold"),
    title = element_text(size=title_size, family="open", face="bold")
  )

# multispeq
## phiPS2
### because phiPS2 is a proportion [0:1], we don't have to create PDFs and CDFs or perform KS tests. We can still do those to be thorough, but it's not necessary. For a proportion we can just logit transform it then use a linear model.

### check for heteroscedasticity
###### Pr(>F) of < 0.05 means that the value is homoscedastic
leveneTest(d22_m$phi2~d22_m$treatment)
leveneTest(d22_m$logitps2~d22_m$treatment)

### box plot of logit PhiPS2 by treatment
ggplot(data = d22_m, aes(x= treatment, y = logitps2, 
                         fill=treatment, color=treatment)) +
  geom_boxplot(alpha=.5, width=0.5, outliers = FALSE)+
  geom_jitter( width=.15, height=0)+
  scale_fill_manual(values=four_colors)+
  scale_color_manual(values=four_colors)+
  labs(
    tag="2022",
    title="Logit PhiPS2 by Inoculation Treatment in Tomato"
  ) +
  ylab("PhiPS2")+
  xlab("Treatment")+
  theme_bw()+
  theme(
    legend.position="none",
    text = element_text(size=subtitle_size, family="mont", lineheight=0.8),
    axis.title = element_text(size=subtitle_size, family = "mont", face= "bold"),
    title = element_text(size=title_size, family="open", face="bold")
  )

### logit PhiPS2 by date scatterplot
ggplot(data = d22_m, aes(x= date, y = logitps2, 
                         fill=treatment, color=treatment,
                         shape = device.id)) +
#  facet_wrap(~plant)+
  geom_jitter( width=2, height=0)+
  scale_fill_manual(values=four_colors)+
  scale_color_manual(values=four_colors)+
  labs(
    tag="2022",
    title="Logit PhiPS2 by Date and Inoculation Treatment in Tomato"
  ) +
  ylab("PhiPS2")+
  xlab("Date")+
  theme_bw()+
  theme(
    legend.position="right",
    text = element_text(size=subtitle_size, family="mont", lineheight=0.8),
    axis.title = element_text(size=subtitle_size, family = "mont", face= "bold"),
    title = element_text(size=title_size, family="open", face="bold")
  )
ggsave("22ps2_by_date.svg", path = "C:/Github/Thesis/figures/TIP22",
       width = 10, height = 8)


### logit PhiPS2 by time scatterplot
ggplot(data = d22_m, aes(x= time, y = logitps2, 
                         fill=treatment, color=treatment,
                         shape = device.id)) +
  geom_jitter( width=0, height=0)+
  scale_fill_manual(values=four_colors)+
  scale_color_manual(values=four_colors)+
  scale_x_discrete(guide=guide_axis(check.overlap=TRUE))+
  labs(
    tag="2022",
    title="Logit PhiPS2 by Time and Inoculation Treatment in Tomato"
  ) +
  ylab("PhiPS2")+
  xlab("Time")+
  theme_bw()+
  theme(
    legend.position="right",
    text = element_text(size=subtitle_size, family="mont", lineheight=0.8),
    axis.title = element_text(size=subtitle_size, family = "mont", face= "bold"),
    title = element_text(size=title_size, family="open", face="bold")
  )
ggsave("22ps2_by_time.svg", path = "C:/Github/Thesis/figures/TIP22",
       width = 10, height = 8)

```

### 2.2.2. 2022 Models and Post Hoc Analysis
```{r 22models}
# fruit
## fruit count
### create model
mod22_fc <- lm(fruit_sum ~ treatment, data = d22_f_summary_byplant)
AIC(mod22_fc)
summary(mod22_fc)
### post hoc comparisons
comps <- glht(mod22_fc, linfct = mcp(treatment = "Tukey"))
d22_fc_letters <- cld(comps)$mcletters$Letters
print(d22_fc_letters)

## mean mass
### model
mod22_fmm <- lm(log(mass_mean) ~ treatment, data = d22_f_means_omitna)
AIC(mod22_fmm)
summary(mod22_fmm)

## pber
### model
mod22_fber <- lm(logit(pber) ~ treatment, data = d22_f_summary_byplant)
AIC(mod22_fber)
summary(mod22_fber)

## sugar %
mod22_sug <- lm(sugar_avg ~ treatment + mass, data = d22_f_omitna)
AIC(mod22_sug)
summary(mod22_sug)
### post hoc comparisons
comps <- glht(mod22_sug, linfct = mcp(treatment = "Tukey"))
d22_sug_letters <- cld(comps)$mcletters$Letters
print(d22_sug_letters)
predict_plot(mod22_sug, d22_f_omitna, sugar_avg, mass, treatment, 100,
             correction = "normal")+
  labs(tag = "2022")+
  ylab("Sugar (%)")+
  xlab("Fruit Mass (g)")+
  guides(fill=guide_legend(title="Treatment"),
         color=guide_legend(title="Treatment"))+
  scale_color_scico_d(begin = 0.9, end = 0.1, palette = a_palette)+
  scale_fill_scico_d(begin = 0.9, end = 0.1, palette = a_palette)
ggsave("22_sug_pred_CI.svg", path = "C:/Github/Thesis/figures/TIP22",
       width = 10, height = 6)

# multispeq
## phips2
### model
mod22_mps2 <- lm(logit(phi2)~ treatment + ambient.humidity, data = d22_m)
AIC(mod22_mps2)
summary(mod22_mps2)
```

## 2.3. 2023 Analysis

### 2.3.1 2023 Exploratory Analysis
```{r 23exploratory}
# fruit greenhouse
## mass
### PDF, CDF, and KS test
multipdf_plot(d23_fg$mass, 100, "all", a_palette, "mass")
ggsave("23_mass_PDF.svg", path = "C:/Github/Thesis/figures/TIP23")
ggsave("23_mass_PDF.png", path = "C:/Github/Thesis/figures/TIP23")
multicdf_plot(d23_fg$mass, 100, "all", a_palette, "mass")
ggsave("23_mass_CDF.svg", path = "C:/Github/Thesis/figures/TIP23")
ggsave("23_mass_CDF.png", path = "C:/Github/Thesis/figures/TIP23")
multiks_cont(d23_fg$mass, "all")

## check for heteroscedasticity
### in mass as a function of treatment
leveneTest(d23_fg$mass~d23_fg$treatment)
### in mass as a function of ber
leveneTest(d23_fg$mass~d23_fg$ber)

## box plot of mass by Treatment
ggplot(data = d23_fg, aes(x= treatment, y = mass, 
                         fill=treatment, color=treatment)) +
  geom_boxplot(alpha=.5, width=0.5, outliers = FALSE)+
  geom_jitter( width=.15, height=0)+
  scale_fill_manual(values=four_colors)+
  scale_color_manual(values=four_colors)+
  labs(
    title=NULL,
    subtitle = NULL
  ) +
  ylab("Mass (g)")+
  xlab("Treatment")+
  theme_bw()+
  theme(
    legend.position="none",
    text = element_text(size=subtitle_size, family="mont", lineheight=0.8),
    axis.title = element_text(size=subtitle_size, family = "mont", face= "bold"),
    title = element_text(size=title_size, family="open", face="bold")
  )

## box plot by Treatment colored by BER
ggplot(data = d23_fg, aes(x= treatment, y = mass, 
                         fill=ber, color=ber)) +
  geom_boxplot(alpha=.5, width=0.6, outliers = TRUE)+
  scale_fill_manual(values=two_colors)+
  scale_color_manual(values=two_colors)+
  guides(fill=guide_legend(title=str_wrap("Blossom-End Rot", 10)),
         color=guide_legend(title=str_wrap("Blossom-End Rot", 10))
         )+
  labs(
    title=NULL,
    subtitle = NULL
  ) +
  ylab("Mass (g)")+
  xlab("Treatment")+
  theme_bw()+
  theme(
    legend.position="right",
    legend.title = element_text(size=subtitle_size, family="mont",
                                face = "bold", lineheight=0.5),
    text = element_text(size=subtitle_size, family="mont", lineheight=0.8),
    axis.title = element_text(size=subtitle_size, family = "mont", face= "bold"),
    title = element_text(size=title_size, family="open", face="bold")
  )
ggsave("23_mass_by_ber.svg", path = "C:/Github/Thesis/figures/TIP23")
ggsave("23_mass_by_ber.png", path = "C:/Github/Thesis/figures/TIP23")

## summarized fruit graphs
### box plot of mean mass of ALL tomatoes by treatment
ggplot(data = d23_fg_means, aes(x= treatment, y = mean, 
                         fill=treatment, color=treatment)) +
  geom_boxplot(alpha=.5, width=0.5, outliers = FALSE)+
  geom_jitter( width=.15, height=0)+
  scale_fill_manual(values=four_colors)+
  scale_color_manual(values=four_colors)+
  labs(
    title=NULL,
    subtitle = NULL
  ) +
  ylab("Mass (g)")+
  xlab("Treatment")+
  theme_bw()+
  theme(
    legend.position="none",
    text = element_text(size=subtitle_size, family="mont", lineheight=0.8),
    axis.title = element_text(size=subtitle_size, family = "mont", face= "bold"),
    title = element_text(size=title_size, family="open", face="bold")
  )

### box plot of mean mass by treatment
ggplot(data = d23_fl_means, aes(x= treatment, y = mass_mean, 
                         fill=treatment, color=treatment)) +
  geom_boxplot(alpha=.5, width=0.5, outliers = FALSE)+
  geom_jitter( width=.15, height=0)+
  scale_fill_manual(values=four_colors)+
  scale_color_manual(values=four_colors)+
  labs(
    title=NULL,
    subtitle = NULL
  ) +
  ylab("Mass (g)")+
  xlab("Treatment")+
  theme_bw()+
  theme(
    legend.position="none",
    text = element_text(size=subtitle_size, family="mont", lineheight=0.8),
    axis.title = element_text(size=subtitle_size, family = "mont", face= "bold"),
    title = element_text(size=title_size, family="open", face="bold")
  )
ggsave("23_mass_mean.svg", path = "C:/Github/Thesis/figures/TIP23")
ggsave("23_mass_mean.png", path = "C:/Github/Thesis/figures/TIP23")

### box plot of mean sugar by treatment
ggplot(data = d23_fl_means, aes(x= treatment, y = sugar_grams_mean, 
                         fill=treatment, color=treatment)) +
  geom_boxplot(alpha=.5, width=0.5, outliers = FALSE)+
  geom_jitter( width=.15, height=0)+
  scale_fill_manual(values=four_colors)+
  scale_color_manual(values=four_colors)+
  labs(
    title=NULL,
    subtitle = NULL
  ) +
  ylab("Mass (g)")+
  xlab("Treatment")+
  theme_bw()+
  theme(
    legend.position="none",
    text = element_text(size=subtitle_size, family="mont", lineheight=0.8),
    axis.title = element_text(size=subtitle_size, family = "mont", face= "bold"),
    title = element_text(size=title_size, family="open", face="bold")
  )
ggsave("23_sugar_mean.svg", path = "C:/Github/Thesis/figures/TIP23")
ggsave("23_sugar_mean.png", path = "C:/Github/Thesis/figures/TIP23")

### box plot of percent BER by treatment
ggplot(data = d23_fg_summary, aes(x= treatment, y = pber, 
                         fill=treatment, color=treatment)) +
  geom_boxplot(alpha=.5, width=0.5, outliers = FALSE)+
  geom_jitter( width=.15, height=0)+
  scale_fill_manual(values=four_colors)+
  scale_color_manual(values=four_colors)+
  labs(
    title=NULL,
    subtitle = NULL
  ) +
  ylab("pBER")+
  xlab("Treatment")+
  theme_bw()+
  theme(
    legend.position="none",
    text = element_text(size=subtitle_size, family="mont", lineheight=0.8),
    axis.title = element_text(size=subtitle_size, family = "mont", face= "bold"),
    title = element_text(size=title_size, family="open", face="bold")
  )
ggsave("23_ber.svg", path = "C:/Github/Thesis/figures/TIP23")
ggsave("23_ber.png", path = "C:/Github/Thesis/figures/TIP23")

### box plot of total fruit mass by treatment
ggplot(data = d23_fg_summary, aes(x= treatment, y = mass_sum, 
                         fill=treatment, color=treatment)) +
  geom_boxplot(alpha=.5, width=0.5, outliers = FALSE)+
  geom_jitter( width=.15, height=0)+
  scale_fill_manual(values=four_colors)+
  scale_color_manual(values=four_colors)+
  labs(
    title=NULL,
    subtitle = NULL
  ) +
  ylab("Mass (g)")+
  xlab("Treatment")+
  theme_bw()+
  theme(
    legend.position="none",
    text = element_text(size=subtitle_size, family="mont", lineheight=0.8),
    axis.title = element_text(size=subtitle_size, family = "mont", face= "bold"),
    title = element_text(size=title_size, family="open", face="bold")
  )

### box plot of percent BER by treatment
ggplot(data = d23_fg_summary, aes(x= treatment, y = fruit_sum, 
                         fill=treatment, color=treatment)) +
  geom_boxplot(alpha=.5, width=0.5, outliers = FALSE)+
  geom_jitter( width=.15, height=0)+
  scale_fill_manual(values=four_colors)+
  scale_color_manual(values=four_colors)+
  labs(
    title=NULL,
    subtitle = NULL
  ) +
  ylab("Fruit")+
  xlab("Treatment")+
  theme_bw()+
  theme(
    legend.position="none",
    text = element_text(size=subtitle_size, family="mont", lineheight=0.8),
    axis.title = element_text(size=subtitle_size, family = "mont", face= "bold"),
    title = element_text(size=title_size, family="open", face="bold")
  )
ggsave("23_fruit_count.svg", path = "C:/Github/Thesis/figures/TIP23")
ggsave("23_fruit_count.png", path = "C:/Github/Thesis/figures/TIP23")

## sugar
### PDF, CDF, and KS test
multipdf_plot(d23_fl$sugar_grams, 100, "all", a_palette, "sugar")
ggsave("23_sugar_PDF.svg", path = "C:/Github/Thesis/figures/TIP23")
ggsave("23_sugar_PDF.png", path = "C:/Github/Thesis/figures/TIP23")
multicdf_plot(d23_fl$sugar_grams, 100, "all", a_palette, "sugar")
ggsave("23_sugar_CDF.svg", path = "C:/Github/Thesis/figures/TIP23")
ggsave("23_sugar_CDF.png", path = "C:/Github/Thesis/figures/TIP23")
multiks_cont(d23_fl$sugar_grams, "all")

## check for heteroscedasticity
### in sugar as a function of treatment
leveneTest(d23_fl$sugar_grams~d23_fl$treatment)
###### NOT homoscedastic! Unequal variances!

## box plot of sugar % by Treatment
ggplot(data = d23_fl, aes(x= treatment, y = sugar_avg, 
                         fill=treatment, color=treatment)) +
  geom_boxplot(alpha=.5, width=0.5, outliers = FALSE)+
  geom_jitter( width=.15, height=0)+
  scale_fill_manual(values=four_colors)+
  scale_color_manual(values=four_colors)+
  labs(
    title=NULL,
    subtitle = NULL
  ) +
  ylab("Sugar %")+
  xlab("Treatment")+
  theme_bw()+
  theme(
    legend.position="none",
    text = element_text(size=subtitle_size, family="mont", lineheight=0.8),
    axis.title = element_text(size=subtitle_size, family = "mont", face= "bold"),
    title = element_text(size=title_size, family="open", face="bold")
  )

## box plot of sugar by Treatment
ggplot(data = d23_fl, aes(x= treatment, y = sugar_grams, 
                         fill=treatment, color=treatment)) +
  geom_boxplot(alpha=.5, width=0.5, outliers = FALSE)+
  geom_jitter( width=.15, height=0)+
  scale_fill_manual(values=four_colors)+
  scale_color_manual(values=four_colors)+
  labs(
    title=NULL,
    subtitle = NULL
  ) +
  ylab("Sugar (g)")+
  xlab("Treatment")+
  theme_bw()+
  theme(
    legend.position="none",
    text = element_text(size=subtitle_size, family="mont", lineheight=0.8),
    axis.title = element_text(size=subtitle_size, family = "mont", face= "bold"),
    title = element_text(size=title_size, family="open", face="bold")
  )

## scatter plot of sugar by mass
ggplot(data = d23_fl, aes(x= mass, y = sugar_avg, 
                         fill=treatment, color=treatment)) +
  geom_jitter( width=0, height=0)+
  scale_fill_manual(values=four_colors)+
  scale_color_manual(values=four_colors)+
  labs(
    title=NULL,
    subtitle = NULL
  ) +
  ylab("Sugar %")+
  xlab("Mass (g)")+
  theme_bw()+
  theme(
    legend.position="right",
    text = element_text(size=subtitle_size, family="mont", lineheight=0.8),
    axis.title = element_text(size=subtitle_size, family = "mont", face= "bold"),
    title = element_text(size=title_size, family="open", face="bold")
  )
ggsave("23_sugar_by_mass.svg", path = "C:/Github/Thesis/figures/TIP23")
ggsave("23_sugar_by_mass.png", path = "C:/Github/Thesis/figures/TIP23")

## box plot of mean sugar by Treatment
ggplot(data = d23_fl_means, aes(x= treatment, y = sugar_grams_mean, 
                         fill=treatment, color=treatment)) +
  geom_boxplot(alpha=.5, width=0.5, outliers = FALSE)+
  geom_jitter( width=.15, height=0)+
  scale_fill_manual(values=four_colors)+
  scale_color_manual(values=four_colors)+
  labs(
    title=NULL,
    subtitle = NULL
  ) +
  ylab("Sugar %")+
  xlab("Treatment")+
  theme_bw()+
  theme(
    legend.position="none",
    text = element_text(size=subtitle_size, family="mont", lineheight=0.8),
    axis.title = element_text(size=subtitle_size, family = "mont", face= "bold"),
    title = element_text(size=title_size, family="open", face="bold")
  )
ggsave("23_sugar_grams_mean.svg", path = "C:/Github/Thesis/figures/TIP23")
ggsave("23_sugar_grams_mean.png", path = "C:/Github/Thesis/figures/TIP23")


## box plot of total sugar by Treatment
ggplot(data = d23_fl_summary, aes(x= treatment, y = sugar_grams_sum, 
                         fill=treatment, color=treatment)) +
  geom_boxplot(alpha=.5, width=0.5, outliers = FALSE)+
  geom_jitter( width=.15, height=0)+
  scale_fill_manual(values=four_colors)+
  scale_color_manual(values=four_colors)+
  labs(
    title=NULL,
    subtitle = NULL
  ) +
  ylab("Sugar (g)")+
  xlab("Treatment")+
  theme_bw()+
  theme(
    legend.position="none",
    text = element_text(size=subtitle_size, family="mont", lineheight=0.8),
    axis.title = element_text(size=subtitle_size, family = "mont", face= "bold"),
    title = element_text(size=title_size, family="open", face="bold")
  )
# li-600

# PDF, CDF, and KS test
multipdf_plot(filter(d23_li, gsw >0)$gsw, 100, "all", a_palette, "gsw")
ggsave("23_gsw_PDF.svg", path = "C:/Github/Thesis/figures/TIP23")
ggsave("23_gsw_PDF.png", path = "C:/Github/Thesis/figures/TIP23")
multicdf_plot(filter(d23_li, gsw >0)$gsw, 100, "all", a_palette, "gsw")
ggsave("23_gsw_CDF.svg", path = "C:/Github/Thesis/figures/TIP23")
ggsave("23_gsw_CDF.png", path = "C:/Github/Thesis/figures/TIP23")
multiks_cont(filter(d23_li, gsw >0)$gsw, "all")

# check for heteroscedasticity
## in gsw as a function of treatment
leveneTest(d23_li$gsw~d23_li$treatment)
## in gsw as a function of time from start
leveneTest(d23_li$gsw~d23_li$minutesfromstart)

## box plot by Treatment
ggplot(data = d23_li, aes(x= treatment, y = gsw, fill=treatment, color=treatment)) +
  geom_boxplot(alpha=.5, width=0.3, outliers = FALSE)+
    geom_jitter( width=.15, height=0)+
  scale_fill_manual(values=four_colors)+
  scale_color_manual(values=four_colors)+
  labs(
    title=NULL,
    subtitle = NULL
  ) +
  ylab("Stomatal Conductance (mol m-2 s-1)")+
#  annotate("text", x=1:4, y=3, label = c("a", "b", "b", "b"), size=5, family="open")+
  theme_bw()+
  theme(
    legend.position="none",
    text = element_text(size=16, family="mont", lineheight=0.8),
    axis.title = element_text(size=16, family = "mont", face= "bold"),
    title = element_text(size=20, family="open", face="bold")
  )

# GSW by date across relative humidity
ggplot(data = d23_li, aes(x=daysfromgermination, y = gsw, 
                           color = rh_s)) +
  geom_jitter(width=1, size=2, alpha=1)+
  scale_color_scico(begin=0.9, end=0, palette=a_palette)+
#  scale_x_discrete(guide=guide_axis(check.overlap=TRUE))+
  theme_bw()+
  ylab("Stomatal Conductance (mol m-2 s-1)")+
  xlab("Days From Germination")+
  labs(
    title=NULL,
    subtitle = NULL
  ) +
    guides(color=guide_colorbar(title=str_wrap("Relative Humidity", 10)))+
  theme(
    text = element_text(size=16, family="mont"),
    legend.title = element_text(size=16, family="mont", face="bold"),
    legend.text = element_text(size=14, family="mont"),
    legend.position="right",
    legend.title.position = "top",
    legend.key.height = unit(.4, "cm"),
    legend.background = element_rect(color=two_colors[2], fill=NA,
                                     linewidth=.5, linetype = 2),
    axis.title = element_text(size=16, family = "mont", face= "bold"),
    title = element_text(size=20, family="open", face="bold", lineheight = .8)
  )
ggsave("23_gsw_by_date.svg", path = "C:/Github/Thesis/figures/TIP23")
ggsave("23_gsw_by_date.png", path = "C:/Github/Thesis/figures/TIP23")

# GSW by time across relative humidity
ggplot(data = d23_li, aes(x=time, y = gsw, 
                           color = date,
                           shape = treatment)) +
  geom_jitter(width=1, size=2, alpha=1)+
  scale_color_scico(begin=0.9, end=0, palette=a_palette)+
  scale_shape_manual(values=four_shapes)+
  scale_x_discrete(guide=guide_axis(check.overlap=TRUE))+
  theme_bw()+
  ylab("Stomatal Conductance (mol m-2 s-1)")+
  xlab("Time")+
  labs(
    title=NULL,
    subtitle = NULL
  ) +
    guides(color=guide_legend(title="Date"))+
  theme(
    text = element_text(size=16, family="mont"),
    legend.title = element_text(size=16, family="mont", face="bold"),
    legend.text = element_text(size=14, family="mont"),
    legend.position="right",
    legend.title.position = "top",
    legend.key.height = unit(.3, "cm"),
    legend.background = element_rect(color=two_colors[2], fill=NA,
                                     linewidth=.5, linetype = 2),
    axis.title = element_text(size=16, family = "mont", face= "bold"),
    title = element_text(size=20, family="open", face="bold", lineheight = .5)
  )
ggsave("23_gsw_by_time.svg", path = "C:/Github/Thesis/figures/TIP23")
ggsave("23_gsw_by_time.png", path = "C:/Github/Thesis/figures/TIP23")

# gsw by relative humidity across treatment groups
ggplot(data = d23_li, aes(x=rh_s, y = gsw, 
                           shape=treatment, fill=treatment, color = treatment)) +
  geom_jitter(width=1, size=2, alpha=1)+
  scale_color_manual(values=four_colors)+
  scale_shape_manual(values=four_shapes)+
  scale_fill_manual(values=four_colors)+
  #ylim(0,1)+
  theme_bw()+
  ylab("Stomatal Conductance (mol m-2 s-1)")+
  xlab("Relative Humidity")+
  labs(
    title=NULL,
    subtitle = NULL
  ) +
  theme(
    text = element_text(size=16, family="mont"),
    legend.title = element_text(size=16, family="mont", face="bold"),
    legend.text = element_text(size=14, family="mont"),
    legend.position="inside",
    legend.title.position = "top",
    legend.position.inside=c(0.15,0.75),
    legend.key.height = unit(.3, "cm"),
    legend.background = element_rect(color=four_colors[3], fill=NA, 
                                     linewidth=.5, linetype = 2),
    axis.title = element_text(size=16, family = "mont", face= "bold"),
    title = element_text(size=20, family="open", face="bold", lineheight = .5)
  )

# gsw by Minutes from Start
ggplot(data = d23_li, aes(x=minutesfromstart, y = gsw, color = rh_s)) +
  geom_point()+
  scale_color_scico(begin=0.9, end=0, palette=a_palette)+
  theme_bw()+
  ylab("Stomatal Conductance (mol m-2 s-1)")+
  xlab("Minutes From Start")+
  labs(
    title=NULL,
    subtitle = NULL
  ) +
      guides(color=guide_colorbar(title=str_wrap("Relative Humidity", 8)))+
  theme(
    text = element_text(size=16, family="mont"),
    legend.position="right",
    axis.title = element_text(size=16, family = "mont", face= "bold"),
    title = element_text(size=20, family="open", face="bold", lineheight = .8)
  )

# multispeq
## phiPS2
### because phiPS2 is a proportion [0:1], we don't have to create PDFs and CDFs or perform KS tests. We can still do those to be thorough, but it's not necessary. For a proportion we can just logit transform it then use a linear model.

### check for heteroscedasticity
###### Pr(>F) of < 0.05 means that the value is homoscedastic
leveneTest(d23_m$phi2~d23_m$treatment)
leveneTest(d23_m$logitps2~d23_m$treatment)

### box plot of logit PhiPS2 by treatment
ggplot(data = d23_m, aes(x= treatment, y = logitps2, 
                         fill=treatment, color=treatment)) +
  geom_boxplot(alpha=.5, width=0.5, outliers = FALSE)+
  geom_jitter( width=.15, height=0)+
  scale_fill_manual(values=four_colors)+
  scale_color_manual(values=four_colors)+
  labs(
    title=NULL,
    subtitle = NULL
  ) +
  ylab("PhiPS2")+
  xlab("Treatment")+
  theme_bw()+
  theme(
    legend.position="none",
    text = element_text(size=subtitle_size, family="mont", lineheight=0.8),
    axis.title = element_text(size=subtitle_size, family = "mont", face= "bold"),
    title = element_text(size=title_size, family="open", face="bold")
  )

### logit PhiPS2 by date scatterplot
ggplot(data = d23_m, aes(x= date, y = logitps2, 
                         fill=treatment, color=treatment,
                         shape = device.id)) +
#  facet_wrap(~plant)+
  geom_jitter( width=2, height=0)+
  scale_fill_manual(values=four_colors)+
  scale_color_manual(values=four_colors)+
  labs(
    title=NULL,
    subtitle = NULL
  ) +
  ylab("PhiPS2")+
  xlab("Date")+
  theme_bw()+
  theme(
    legend.position="right",
    text = element_text(size=subtitle_size, family="mont", lineheight=0.8),
    axis.title = element_text(size=subtitle_size, family = "mont", face= "bold"),
    title = element_text(size=title_size, family="open", face="bold")
  )
ggsave("23_phi2_by_date.svg", path = "C:/Github/Thesis/figures/TIP23")
ggsave("23_phi2_by_date.png", path = "C:/Github/Thesis/figures/TIP23")

### logit PhiPS2 by time scatterplot
ggplot(data = d23_m, aes(x= time, y = logitps2, 
                         fill=treatment, color=treatment,
                         shape = device.id)) +
  geom_jitter( width=0, height=0)+
  scale_fill_manual(values=four_colors)+
  scale_color_manual(values=four_colors)+
  scale_x_discrete(guide=guide_axis(check.overlap=TRUE))+
  labs(
    title=NULL,
    subtitle = NULL
  ) +
  ylab("PhiPS2")+
  xlab("Time")+
  theme_bw()+
  theme(
    legend.position="right",
    text = element_text(size=subtitle_size, family="mont", lineheight=0.8),
    axis.title = element_text(size=subtitle_size, family = "mont", face= "bold"),
    title = element_text(size=title_size, family="open", face="bold")
  )
ggsave("23_phi2_by_time.svg", path = "C:/Github/Thesis/figures/TIP23")
ggsave("23_phi2_by_time.png", path = "C:/Github/Thesis/figures/TIP23")

```

### 2.3.2. 2023 Models and Post Hoc Analyses
```{r 23models}
# fruit
## mass
mod23_mass <- lm(log(mass_mean) ~ treatment, data = d23_fl_means)
AIC(mod23_mass)
summary(mod23_mass)
comps <- glht(mod23_mass, linfct = mcp(treatment = "Tukey"))
mod23_mass_letters <- cld(comps)$mcletters$Letters
print(mod23_mass_letters)
## annotated mass boxplot
ggplot(data = d23_fl_means, aes(x= treatment, y = mass_mean, 
                         fill=treatment, color=treatment)) +
  geom_boxplot(alpha=.5, width=0.5, outliers = FALSE)+
  geom_jitter( width=.15, height=0)+
  scale_fill_manual(values=four_colors)+
  scale_color_manual(values=four_colors)+
  labs(
    title=NULL,
    subtitle = NULL
  ) +
  annotate("text", x=1:4, y=140, label = mod23_mass_letters, size=10, family="open")+
  ylab("Mass (g)")+
  xlab("Treatment")+
  theme_bw()+
  theme(
    legend.position="none",
    text = element_text(size=subtitle_size, family="mont", lineheight=0.8),
    axis.title = element_text(size=subtitle_size, family = "mont", face= "bold"),
    title = element_text(size=title_size, family="open", face="bold")
  )
ggsave("23_mass_box_annotated.svg", path = "C:/Github/Thesis/figures/TIP23")
ggsave("23_mass_box_annotated.png", path = "C:/Github/Thesis/figures/TIP23")
## ber
mod23_ber <- lm(logit(pber) ~ treatment, data = d23_fg_summary)
AIC(mod23_ber)
summary(mod23_ber)
comps <- glht(mod23_ber, linfct = mcp(treatment = "Tukey"))
mod23_ber_letters <- cld(comps)$mcletters$Letters
print(mod23_ber_letters)

## sugar
mod23_sug <- lm(logit(sugar_avg_mean)~ treatment, data = d23_fl_means)
AIC(mod23_sug)
summary(mod23_sug)
comps <- glht(mod23_sug, linfct = mcp(treatment = "Tukey"))
mod23_sug_letters <- cld(comps)$mcletters$Letters
print(mod23_sug_letters)

## box plot of total sugar by Treatment
ggplot(data = d23_fl_means, aes(x= treatment, y = sugar_avg_mean, 
                         fill=treatment, color=treatment)) +
  geom_boxplot(alpha=.5, width=0.5, outliers = FALSE)+
  geom_jitter( width=.15, height=0)+
  scale_fill_manual(values=four_colors)+
  scale_color_manual(values=four_colors)+
  labs(
    title=NULL,
    subtitle = NULL
  ) +
    annotate("text", x=1:4, y=10, label = mod23_sug_letters, size=10, family="open")+
  ylab("Sugar (%)")+
  xlab("Treatment")+
  theme_bw()+
  theme(
    legend.position="none",
    text = element_text(size=subtitle_size, family="mont", lineheight=0.8),
    axis.title = element_text(size=subtitle_size, family = "mont", face= "bold"),
    title = element_text(size=title_size, family="open", face="bold")
  )
ggsave("23_sug_box_annotated.svg", path = "C:/Github/Thesis/figures/TIP23")
ggsave("23_sug_box_annotated.png", path = "C:/Github/Thesis/figures/TIP23")
## fruit count
mod23_fc <- glm(fruit_sum ~ treatment, data = d23_fg_summary,
                family = poisson(link = "identity"))
AIC(mod23_fc)
summary(mod23_fc)
glm_pseudor2(mod23_fc)
comps <- glht(mod23_fc, linfct = mcp(treatment = "Tukey"))
mod23_fc_letters <- cld(comps)$mcletters$Letters
print(mod23_fc_letters)

ggplot(data = d23_fg_summary, aes(x= treatment, y = fruit_sum, 
                         fill=treatment, color=treatment)) +
  geom_boxplot(alpha=.5, width=0.5, outliers = FALSE)+
  geom_jitter( width=.15, height=0)+
  scale_fill_manual(values=four_colors)+
  scale_color_manual(values=four_colors)+
  labs(
    title=NULL,
    subtitle = NULL
  ) +
  annotate("text", x=1:4, y=100, label = mod23_fc_letters, size=10, family="open")+
  ylab("Fruit")+
  xlab("Treatment")+
  theme_bw()+
  theme(
    legend.position="none",
    text = element_text(size=subtitle_size, family="mont", lineheight=0.8),
    axis.title = element_text(size=subtitle_size, family = "mont", face= "bold"),
    title = element_text(size=title_size, family="open", face="bold")
  )

ggsave("23_fc_box_annotated.svg", path = "C:/Github/Thesis/figures/TIP23")
ggsave("23_fc_box_annotated.png", path = "C:/Github/Thesis/figures/TIP23")


## marketable fruit count
mod23_fc2 <- glm(fruit_sum ~ treatment, data = d23_fl_summary,
                family = poisson(link = "identity"))
AIC(mod23_fc2)
summary(mod23_fc2)
glm_pseudor2(mod23_fc2)
comps <- glht(mod23_fc2, linfct = mcp(treatment = "Tukey"))
mod23_fc2_letters <- cld(comps)$mcletters$Letters
print(mod23_fc2_letters)


ggplot(data = d23_fl_summary, aes(x= treatment, y = fruit_sum, 
                         fill=treatment, color=treatment)) +
  geom_boxplot(alpha=.5, width=0.5, outliers = FALSE)+
  geom_jitter( width=.15, height=0)+
  scale_fill_manual(values=four_colors)+
  scale_color_manual(values=four_colors)+
  labs(
    title=NULL,
    subtitle = NULL
  ) +
  annotate("text", x=1:4, y=35, label = mod23_fc2_letters, size=10, family="open")+
  ylab("Fruit")+
  xlab("Treatment")+
  theme_bw()+
  theme(
    legend.position="none",
    text = element_text(size=subtitle_size, family="mont", lineheight=0.8),
    axis.title = element_text(size=subtitle_size, family = "mont", face= "bold"),
    title = element_text(size=title_size, family="open", face="bold")
  )

ggsave("23_mfc_box_annotated.svg", path = "C:/Github/Thesis/figures/TIP23")
ggsave("23_mfc_box_annotated.png", path = "C:/Github/Thesis/figures/TIP23")

## total fruit mass
mod23_msum <- lm(mass_sum ~ treatment, data = d23_fg_summary)
AIC(mod23_msum)
summary(mod23_msum)
comps <- glht(mod23_msum, linfct = mcp(treatment = "Tukey"))
mod23_msum_letters <- cld(comps)$mcletters$Letters
print(mod23_msum_letters)


# fluorescence
d23_ps2_pcadat <- pca_data(d23_ps2_joined, d23_ps2_joined[,c(9:13)])
## phi2 pca
mod23_phi2_3 <- lmer(logit(phips2) ~ treatment + PC1 + (1 | Device), data = d23_ps2_pcadat)
AIC(mod23_phi2_3)
summary(mod23_phi2_3)
r.squaredGLMM(mod23_phi2_3)
comps <- glht(mod23_phi2_3, linfct = mcp(treatment = "Tukey"))
mod23_phi2_3_letters <- cld(comps)$mcletters$Letters
print(mod23_phi2_3_letters)
mod23_phi2_3r <- lm(logit(phips2) ~ treatment + PC1, data = d23_ps2_pcadat)
predict_plot(mod23_phi2_3r, d23_ps2_pcadat, phips2, PC1, treatment, 100,
             correction = "logit")+
  ylim(0.5,0.8)+
  ylab("PhiPS2")+
  xlab("PC1")+
  labs(
    title=NULL,
    subtitle = NULL
  ) +
  guides(fill=guide_legend(title="Treatment"),
         color=guide_legend(title="Treatment"))

## phi2
mod23_phi2 <- lmer(logit(phips2) ~ treatment + daysfromgermination + (1 | Device), data = d23_ps2_joined)
AIC(mod23_phi2)
summary(mod23_phi2)
r.squaredGLMM(mod23_phi2)
comps <- glht(mod23_phi2, linfct = mcp(treatment = "Tukey"))
mod23_phi2_letters <- cld(comps)$mcletters$Letters
print(mod23_phi2_letters)

mod23_phi2_2 <- lm(logit(phips2) ~ treatment + daysfromgermination, data = d23_ps2_joined)
predict_plot(mod23_phi2_2, d23_ps2_joined, phips2, daysfromgermination, treatment, 100,
             correction = "logit")+
  ylim(0.5,0.8)+
  ylab("PhiPS2")+
  xlab("Days From Germination")+
  labs(
    title=NULL,
    subtitle = NULL
  ) +
  guides(fill=guide_legend(title="Treatment"),
         color=guide_legend(title="Treatment"))
ggsave("23_phi2_pred_CI.svg", path = "C:/Github/Thesis/figures/TIP23",
       width = 10, height = 6)
ggsave("23_phi2_pred_CI.png", path = "C:/Github/Thesis/figures/TIP23",
       width = 10, height = 6)
## gsw
mod23_gsw <- lm(log(gsw) ~ treatment + rh_s, data = d23_li)
AIC(mod23_gsw)
summary(mod23_gsw)
comps <- glht(mod23_gsw, linfct = mcp(treatment = "Tukey"))
mod23_gsw_letters <- cld(comps)$mcletters$Letters
print(mod23_gsw_letters)
predict_plot(mod23_gsw, d23_li, gsw, rh_s, treatment, 100,
             correction = "exponential")+
  ylab("Stomatal Conductance  (mol m-2 s-1)")+
  xlab("Relative Humidity (%)")+
  labs(
    title=NULL,
    subtitle = NULL
  ) +
  ylim(0, 2.5)+
  guides(fill=guide_legend(title="Treatment"),
         color=guide_legend(title="Treatment"))+
  scale_color_scico_d(begin = 0.9, end = 0.1, palette = a_palette)+
  scale_fill_scico_d(begin = 0.9, end = 0.1, palette = a_palette)
ggsave("23_gsw_pred_CI.svg", path = "C:/Github/Thesis/figures/TIP23",
       width = 10, height = 6)
ggsave("23_gsw_pred_CI.png", path = "C:/Github/Thesis/figures/TIP23",
       width = 10, height = 6)

# stomatal density
d23_st <- d23_st %>%
  mutate(treatment = as.factor(treatment))
d23_st_lower <- d23_st %>% filter(surface == "Lower")
d23_st_sum <- d23_st_lower %>%
  group_by(treatment, plant) %>%
  summarise_at(vars(stomatal_density), list(mean)) %>%
  ungroup()

mod23_st <- lm(log(stomatal_density) ~ treatment, data = d23_st_sum)
AIC(mod23_st)
summary(mod23_st)
comps <- glht(mod23_st, linfct = mcp(treatment = "Tukey"))
mod23_st_letters <- cld(comps)$mcletters$Letters
print(mod23_st_letters)

ggplot(data = d23_st_sum, aes(x= treatment, y = stomatal_density, 
                         fill=treatment, color=treatment)) +
  geom_boxplot(alpha=.5, width=0.5, outliers = FALSE)+
  geom_jitter( width=.15, height=0)+
  scale_fill_manual(values=four_colors)+
  scale_color_manual(values=four_colors)+
  labs(
    title=NULL,
    subtitle = NULL
  ) +
  annotate("text", x=1:4, y=35, label = mod23_st_letters, size=10, family="open")+
  ylab(str_wrap("Stomatal Density (stomates/cm^2",20))+
  xlab("Treatment")+
  theme_bw()+
  theme(
    legend.position="none",
    text = element_text(size=subtitle_size, family="mont", lineheight=0.8),
    axis.title = element_text(size=subtitle_size, family = "mont", face= "bold"),
    title = element_text(size=title_size, family="open", face="bold")
  )

ggsave("23_st_box_annotated.svg", path = "C:/Github/Thesis/figures/TIP23")
ggsave("23_st_box_annotated.png", path = "C:/Github/Thesis/figures/TIP23")

```

## 2.4. 2024 Analysis

### 2.4.1. 2024 Exploratory Analysis
```{r 24exploratory}
## mass
### PDF, CDF, and KS test
multipdf_plot(d24_f$mass, 100, "all", a_palette, "mass")
ggsave("24_mass_PDF.svg", path = "C:/Github/Thesis/figures/TIP24")
ggsave("24_mass_PDF.png", path = "C:/Github/Thesis/figures/TIP24")

multicdf_plot(d24_f$mass, 100, "all", a_palette, "mass")
ggsave("24_mass_CDF.svg", path = "C:/Github/Thesis/figures/TIP24")
ggsave("24_mass_CDF.png", path = "C:/Github/Thesis/figures/TIP24")
multiks_cont(d24_f$mass, "all")

## check for heteroscedasticity
### in mass as a function of treatment
leveneTest(d24_f$mass~d24_f$treatment)

## box plot of mass by Treatment
ggplot(data = d24_f, aes(x= treatment, y = mass, 
                         fill=treatment, color=treatment)) +
  geom_boxplot(alpha=.5, width=0.5, outliers = FALSE)+
  geom_jitter( width=.15, height=0)+
  scale_fill_manual(values=four_colors)+
  scale_color_manual(values=four_colors)+
  labs(
    title=NULL,
    subtitle = NULL
  ) +
  ylab("Mass (g)")+
  xlab("Treatment")+
  theme_bw()+
  theme(
    legend.position="none",
    text = element_text(size=subtitle_size, family="mont", lineheight=0.8),
    axis.title = element_text(size=subtitle_size, family = "mont", face= "bold"),
    title = element_text(size=title_size, family="open", face="bold")
  )

## box plot by Treatment colored by BER
ggplot(data = d24_f, aes(x= treatment, y = mass, 
                         fill=ber, color=ber)) +
  geom_boxplot(alpha=.5, width=0.6, outliers = TRUE)+
  scale_fill_manual(values=two_colors)+
  scale_color_manual(values=two_colors)+
  guides(fill=guide_legend(title=str_wrap("Blossom-End Rot", 10)),
         color=guide_legend(title=str_wrap("Blossom-End Rot", 10))
         )+
  labs(
    title=NULL,
    subtitle = NULL
  ) +
  ylab("Mass (g)")+
  xlab("Treatment")+
  theme_bw()+
  theme(
    legend.position="right",
    legend.title = element_text(size=subtitle_size, family="mont",
                                face = "bold", lineheight=0.5),
    text = element_text(size=subtitle_size, family="mont", lineheight=0.8),
    axis.title = element_text(size=subtitle_size, family = "mont", face= "bold"),
    title = element_text(size=title_size, family="open", face="bold")
  )
ggsave("24_mass_by_ber.svg", path = "C:/Github/Thesis/figures/TIP24")
ggsave("24_mass_by_ber.png", path = "C:/Github/Thesis/figures/TIP24")

## summarized fruit graphs
### box plot of mean mass by treatment
ggplot(data = d24_f_means, aes(x= treatment, y = mass_mean, 
                         fill=treatment, color=treatment)) +
  geom_boxplot(alpha=.5, width=0.5, outliers = FALSE)+
  geom_jitter( width=.15, height=0)+
  scale_fill_manual(values=four_colors)+
  scale_color_manual(values=four_colors)+
  labs(
    title=NULL,
    subtitle = NULL
  ) +
  ylab("Mass (g)")+
  xlab("Treatment")+
  theme_bw()+
  theme(
    legend.position="none",
    text = element_text(size=subtitle_size, family="mont", lineheight=0.8),
    axis.title = element_text(size=subtitle_size, family = "mont", face= "bold"),
    title = element_text(size=title_size, family="open", face="bold")
  )
ggsave("24_mass_mean_box.svg", path = "C:/Github/Thesis/figures/TIP24")
ggsave("24_mass_mean_box.png", path = "C:/Github/Thesis/figures/TIP24")


### box plot of mean sugar by treatment
ggplot(data = d24_f_means, aes(x= treatment, y = sugar_avg_mean, 
                         fill=treatment, color=treatment)) +
  geom_boxplot(alpha=.5, width=0.5, outliers = FALSE)+
  geom_jitter( width=.15, height=0)+
  scale_fill_manual(values=four_colors)+
  scale_color_manual(values=four_colors)+
  labs(
    title=NULL,
    subtitle = NULL
  ) +
  ylab("Sugar (%)")+
  xlab("Treatment")+
  theme_bw()+
  theme(
    legend.position="none",
    text = element_text(size=subtitle_size, family="mont", lineheight=0.8),
    axis.title = element_text(size=subtitle_size, family = "mont", face= "bold"),
    title = element_text(size=title_size, family="open", face="bold")
  )
ggsave("24_sugar_mean_box.svg", path = "C:/Github/Thesis/figures/TIP24")
ggsave("24_sugar_mean_box.png", path = "C:/Github/Thesis/figures/TIP24")


### box plot of percent BER by treatment
ggplot(data = d24_f_summary, aes(x= treatment, y = pber, 
                         fill=treatment, color=treatment)) +
  geom_boxplot(alpha=.5, width=0.5, outliers = FALSE)+
  geom_jitter( width=.15, height=0)+
  scale_fill_manual(values=four_colors)+
  scale_color_manual(values=four_colors)+
  labs(
    title=NULL,
    subtitle = NULL
  ) +
  ylab("pBER")+
  xlab("Treatment")+
  theme_bw()+
  theme(
    legend.position="none",
    text = element_text(size=subtitle_size, family="mont", lineheight=0.8),
    axis.title = element_text(size=subtitle_size, family = "mont", face= "bold"),
    title = element_text(size=title_size, family="open", face="bold")
  )
ggsave("24_ber_box.svg", path = "C:/Github/Thesis/figures/TIP24")
ggsave("24_ber_box.png", path = "C:/Github/Thesis/figures/TIP24")


### box plot of total fruit mass by treatment
ggplot(data = d24_f_summary, aes(x= treatment, y = mass_sum, 
                         fill=treatment, color=treatment)) +
  geom_boxplot(alpha=.5, width=0.5, outliers = FALSE)+
  geom_jitter( width=.15, height=0)+
  scale_fill_manual(values=four_colors)+
  scale_color_manual(values=four_colors)+
  labs(
    title=NULL,
    subtitle = NULL
  ) +
  ylab("Mass (g)")+
  xlab("Treatment")+
  theme_bw()+
  theme(
    legend.position="none",
    text = element_text(size=subtitle_size, family="mont", lineheight=0.8),
    axis.title = element_text(size=subtitle_size, family = "mont", face= "bold"),
    title = element_text(size=title_size, family="open", face="bold")
  )

### box plot of fruit count by treatment
ggplot(data = d24_f_summary, aes(x= treatment, y = fruit_sum, 
                         fill=treatment, color=treatment)) +
  geom_boxplot(alpha=.5, width=0.5, outliers = FALSE)+
  geom_jitter( width=.15, height=0)+
  scale_fill_manual(values=four_colors)+
  scale_color_manual(values=four_colors)+
  labs(
    title=NULL,
    subtitle = NULL
  ) +
  ylab("Fruit")+
  xlab("Treatment")+
  theme_bw()+
  theme(
    legend.position="none",
    text = element_text(size=subtitle_size, family="mont", lineheight=0.8),
    axis.title = element_text(size=subtitle_size, family = "mont", face= "bold"),
    title = element_text(size=title_size, family="open", face="bold")
  )
ggsave("24_fruit_count.svg", path = "C:/Github/Thesis/figures/TIP24")
ggsave("24_fruit_count.png", path = "C:/Github/Thesis/figures/TIP24")

## sugar
### PDF, CDF, and KS test
multipdf_plot(filter(d24_f, sugar_grams >0)$sugar_grams, 100, "all", a_palette, "sugar (g)")
ggsave("24_sug_PDF.svg", path = "C:/Github/Thesis/figures/TIP24")
ggsave("24_sug_PDF.png", path = "C:/Github/Thesis/figures/TIP24")

multicdf_plot(filter(d24_f, sugar_grams >0)$sugar_grams, 100, "all", a_palette, "sugar (g)")
ggsave("24_sug_CDF.svg", path = "C:/Github/Thesis/figures/TIP24")
ggsave("24_sug_CDF.png", path = "C:/Github/Thesis/figures/TIP24")

multiks_cont(filter(d24_f, sugar_grams >0)$sugar_grams, "all")

## check for heteroscedasticity
### in sugar as a function of treatment
leveneTest(d24_f$sugar_grams~d24_f$treatment)
###### NOT homoscedastic! Unequal variances!

## box plot of sugar % by Treatment
ggplot(data = d24_f, aes(x= treatment, y = sugar_avg, 
                         fill=treatment, color=treatment)) +
  geom_boxplot(alpha=.5, width=0.5, outliers = FALSE)+
  geom_jitter( width=.15, height=0)+
  scale_fill_manual(values=four_colors)+
  scale_color_manual(values=four_colors)+
  labs(
    title=NULL,
    subtitle = NULL
  ) +
  ylab("Sugar %")+
  xlab("Treatment")+
  theme_bw()+
  theme(
    legend.position="none",
    text = element_text(size=subtitle_size, family="mont", lineheight=0.8),
    axis.title = element_text(size=subtitle_size, family = "mont", face= "bold"),
    title = element_text(size=title_size, family="open", face="bold")
  )

## box plot of sugar by Treatment
ggplot(data = d24_f, aes(x= treatment, y = sugar_grams, 
                         fill=treatment, color=treatment)) +
  geom_boxplot(alpha=.5, width=0.5, outliers = FALSE)+
  geom_jitter( width=.15, height=0)+
  scale_fill_manual(values=four_colors)+
  scale_color_manual(values=four_colors)+
  labs(
    title=NULL,
    subtitle = NULL
  ) +
  ylab("Sugar (g)")+
  xlab("Treatment")+
  theme_bw()+
  theme(
    legend.position="none",
    text = element_text(size=subtitle_size, family="mont", lineheight=0.8),
    axis.title = element_text(size=subtitle_size, family = "mont", face= "bold"),
    title = element_text(size=title_size, family="open", face="bold")
  )

## scatter plot of sugar by mass
ggplot(data = d24_f, aes(x= mass, y = sugar_avg, 
                         fill=treatment, color=treatment)) +
  geom_jitter( width=0, height=0)+
  scale_fill_manual(values=four_colors)+
  scale_color_manual(values=four_colors)+
  labs(
    title=NULL,
    subtitle = NULL
  ) +
  ylab("Sugar %")+
  xlab("Mass (g)")+
  theme_bw()+
  theme(
    legend.position="right",
    text = element_text(size=subtitle_size, family="mont", lineheight=0.8),
    axis.title = element_text(size=subtitle_size, family = "mont", face= "bold"),
    title = element_text(size=title_size, family="open", face="bold")
  )
ggsave("24_sug_by_mass.svg", path = "C:/Github/Thesis/figures/TIP24")
ggsave("24_sug_by_mass.png", path = "C:/Github/Thesis/figures/TIP24")

## box plot of total sugar by Treatment
ggplot(data = d24_f_summary_sugar, aes(x= treatment, y = sugar_grams_sum, 
                         fill=treatment, color=treatment)) +
  geom_boxplot(alpha=.5, width=0.5, outliers = FALSE)+
  geom_jitter( width=.15, height=0)+
  scale_fill_manual(values=four_colors)+
  scale_color_manual(values=four_colors)+
  labs(
    title=NULL,
    subtitle = NULL
  ) +
  ylab("Sugar (g)")+
  xlab("Treatment")+
  theme_bw()+
  theme(
    legend.position="none",
    text = element_text(size=subtitle_size, family="mont", lineheight=0.8),
    axis.title = element_text(size=subtitle_size, family = "mont", face= "bold"),
    title = element_text(size=title_size, family="open", face="bold")
  )
# li-600

# PDF, CDF, and KS test
multipdf_plot(filter(d24_li, gsw >0)$gsw, 100, "all", a_palette)
ggsave("24_gsw_PDF.svg", path = "C:/Github/Thesis/figures/TIP24")
ggsave("24_gsw_PDF.png", path = "C:/Github/Thesis/figures/TIP24")

multicdf_plot(filter(d24_li, gsw >0)$gsw, 100, "all", a_palette)
ggsave("24_gsw_CDF.svg", path = "C:/Github/Thesis/figures/TIP24")
ggsave("24_gsw_CDF.png", path = "C:/Github/Thesis/figures/TIP24")
multiks_cont(filter(d24_li, gsw >0)$gsw, "all")

# check for heteroscedasticity
## in gsw as a function of treatment
leveneTest(d24_li$gsw~d24_li$treatment)
## in gsw as a function of time from start
leveneTest(d24_li$gsw~d24_li$minutesfromstart)

## box plot by Treatment boxplot
ggplot(data = d24_li, aes(x= treatment, y = gsw, fill=treatment, color=treatment)) +
  geom_boxplot(alpha=.5, width=0.3, outliers = FALSE)+
    geom_jitter( width=.15, height=0)+
  scale_fill_manual(values=four_colors)+
  scale_color_manual(values=four_colors)+
  labs(
    title=NULL,
    subtitle = NULL
  ) +
  ylab("Stomatal Conductance (mol m-2 s-1)")+
#  annotate("text", x=1:4, y=3, label = c("a", "b", "b", "b"), size=5, family="open")+
  theme_bw()+
  theme(
    legend.position="none",
    text = element_text(size=16, family="mont", lineheight=0.8),
    axis.title = element_text(size=16, family = "mont", face= "bold"),
    title = element_text(size=20, family="open", face="bold")
  )

# GSW by date across relative humidity
ggplot(data = d24_li, aes(x=daysfromgermination, y = gsw, 
                           color = rh_s)) +
  geom_jitter(width=1, size=2, alpha=1)+
  scale_color_scico(begin=0.9, end=0, palette=a_palette)+
#  scale_x_discrete(guide=guide_axis(check.overlap=TRUE))+
  theme_bw()+
  ylab("Stomatal Conductance (mol m-2 s-1)")+
  xlab("Days From Germination")+
  labs(
    title=NULL,
    subtitle = NULL
  ) +
    guides(color=guide_colorbar(title=str_wrap("Relative Humidity", 10)))+
  theme(
    text = element_text(size=16, family="mont"),
    legend.title = element_text(size=16, family="mont", face="bold"),
    legend.text = element_text(size=14, family="mont"),
    legend.position="right",
    legend.title.position = "top",
    legend.key.height = unit(.4, "cm"),
    legend.background = element_rect(color=two_colors[2], fill=NA,
                                     linewidth=.5, linetype = 2),
    axis.title = element_text(size=16, family = "mont", face= "bold"),
    title = element_text(size=20, family="open", face="bold", lineheight = .8)
  )

# GSW by time across relative humidity
ggplot(data = d24_li, aes(x=time, y = gsw, 
                           color = date,
                           shape = treatment)) +
  geom_jitter(width=1, size=2, alpha=1)+
  scale_color_scico(begin=0.9, end=0, palette=a_palette)+
  scale_shape_manual(values=four_shapes)+
  scale_x_discrete(guide=guide_axis(check.overlap=TRUE))+
  theme_bw()+
  ylab("Stomatal Conductance (mol m-2 s-1)")+
  xlab("Time")+
  labs(
    title=NULL,
    subtitle = NULL
  ) +
    guides(color=guide_legend(title="Date"))+
  theme(
    text = element_text(size=16, family="mont"),
    legend.title = element_text(size=16, family="mont", face="bold"),
    legend.text = element_text(size=14, family="mont"),
    legend.position="right",
    legend.title.position = "top",
    legend.key.height = unit(.3, "cm"),
    legend.background = element_rect(color=two_colors[2], fill=NA,
                                     linewidth=.5, linetype = 2),
    axis.title = element_text(size=16, family = "mont", face= "bold"),
    title = element_text(size=20, family="open", face="bold", lineheight = .5)
  )

# gsw by relative humidity across treatment groups
ggplot(data = d24_li, aes(x=rh_s, y = gsw, 
                           shape=treatment, fill=treatment, color = treatment)) +
  geom_jitter(width=1, size=2, alpha=1)+
  scale_color_manual(values=four_colors)+
  scale_shape_manual(values=four_shapes)+
  scale_fill_manual(values=four_colors)+
  #ylim(0,1)+
  theme_bw()+
  ylab("Stomatal Conductance (mol m-2 s-1)")+
  xlab("Relative Humidity")+
  labs(
    title=NULL,
    subtitle = NULL
  ) +
  theme(
    text = element_text(size=16, family="mont"),
    legend.title = element_text(size=16, family="mont", face="bold"),
    legend.text = element_text(size=14, family="mont"),
    legend.position="inside",
    legend.title.position = "top",
    legend.position.inside=c(0.15,0.75),
    legend.key.height = unit(.3, "cm"),
    legend.background = element_rect(color=four_colors[3], fill=NA, 
                                     linewidth=.5, linetype = 2),
    axis.title = element_text(size=16, family = "mont", face= "bold"),
    title = element_text(size=20, family="open", face="bold", lineheight = .5)
  )

# gsw by Minutes from Start
ggplot(data = d24_li, aes(x=minutesfromstart, y = gsw, color = rh_s)) +
  geom_point()+
  scale_color_scico(begin=0.9, end=0, palette=a_palette)+
  theme_bw()+
  ylab("Stomatal Conductance (mol m-2 s-1)")+
  xlab("Minutes From Start")+
  labs(
    title=NULL,
    subtitle = NULL
  ) +
      guides(color=guide_colorbar(title=str_wrap("Relative Humidity", 8)))+
  theme(
    text = element_text(size=16, family="mont"),
    legend.position="right",
    axis.title = element_text(size=16, family = "mont", face= "bold"),
    title = element_text(size=20, family="open", face="bold", lineheight = .8)
  )

# multispeq
## phiPS2
### because phiPS2 is a proportion [0:1], we don't have to create PDFs and CDFs or perform KS tests. We can still do those to be thorough, but it's not necessary. For a proportion we can just logit transform it then use a linear model.

### check for heteroscedasticity
###### Pr(>F) of < 0.05 means that the value is homoscedastic
leveneTest(d24_m$phi2~d24_m$treatment)
leveneTest(d24_m$logitps2~d24_m$treatment)

### box plot of logit PhiPS2 by treatment
ggplot(data = d24_m, aes(x= treatment, y = logitps2, 
                         fill=treatment, color=treatment)) +
  geom_boxplot(alpha=.5, width=0.5, outliers = FALSE)+
  geom_jitter( width=.15, height=0)+
  scale_fill_manual(values=four_colors)+
  scale_color_manual(values=four_colors)+
  labs(
    title=NULL,
    subtitle = NULL
  ) +
  ylab("PhiPS2")+
  xlab("Treatment")+
  theme_bw()+
  theme(
    legend.position="none",
    text = element_text(size=subtitle_size, family="mont", lineheight=0.8),
    axis.title = element_text(size=subtitle_size, family = "mont", face= "bold"),
    title = element_text(size=title_size, family="open", face="bold")
  )

### logit PhiPS2 by date scatterplot
ggplot(data = d24_m, aes(x= date, y = logitps2, 
                         fill=treatment, color=treatment,
                         shape = device.id)) +
#  facet_wrap(~plant)+
  geom_jitter( width=2, height=0)+
  scale_fill_manual(values=four_colors)+
  scale_color_manual(values=four_colors)+
  labs(
    title=NULL,
    subtitle = NULL
  ) +
  ylab("PhiPS2")+
  xlab("Date")+
  theme_bw()+
  theme(
    legend.position="right",
    text = element_text(size=subtitle_size, family="mont", lineheight=0.8),
    axis.title = element_text(size=subtitle_size, family = "mont", face= "bold"),
    title = element_text(size=title_size, family="open", face="bold")
  )

### logit PhiPS2 by time scatterplot
ggplot(data = d24_ps2_joined, aes(x= time, y = logitps2, 
                         fill=treatment, color=treatment,
                         shape = Device)) +
  geom_jitter( width=0, height=0)+
  ylim(0,1.5)+
  scale_fill_manual(values=four_colors)+
  scale_color_manual(values=four_colors)+
  scale_x_discrete(guide=guide_axis(check.overlap=TRUE))+
  labs(
    title=NULL,
    subtitle = NULL
  ) +
  ylab("PhiPS2")+
  xlab("Time")+
  theme_bw()+
  theme(
    legend.position="right",
    text = element_text(size=subtitle_size, family="mont", lineheight=0.8),
    axis.title = element_text(size=subtitle_size, family = "mont", face= "bold"),
    title = element_text(size=title_size, family="open", face="bold")
  )

```

### 2.4.2. 2024 Models and Post Hoc Analysis
```{r 24models}
# fruit
## ber
mod24_ber <- lm(logit(pber) ~ treatment, data=d24_f_summary)
AIC(mod24_ber)
summary(mod24_ber)

## mass
mod24_mass <- lm(log(mass_mean) ~ treatment, data=d24_f_means)
AIC(mod24_mass)
summary(mod24_mass)
confint(mod24_mass)

## sugar
mod24_sug_bp <- lm(sugar_avg_mean ~ treatment, data=d24_f_means)
summary(mod24_sug_bp)
comps <- glht(mod24_sug_bp, linfct=mcp(treatment="Tukey"))
cld(comps)

# fluorescence
## gsw
mod24_gsw <- lm(log(gsw) ~ treatment + rh_s, data = filter(d24_li, gsw>0))
AIC(mod24_gsw)
summary(mod24_gsw)
comps <- glht(mod24_gsw, linfct = mcp(treatment = "Tukey"))
mod24_gsw_letters <- cld(comps)$mcletters$Letters
print(mod24_gsw_letters)

predict_plot(mod24_gsw, filter(d24_li, gsw>0), gsw, rh_s, treatment,
             100, correction = "exponential")+
  ylab("Stomatal Conductance (mol m-2 s-1)")+
  xlab("Relative Humidity (%)")+
  ylim(0,2)+
  labs(
    title=NULL,
    subtitle = NULL
  ) +
  guides(
    fill = guide_legend(title="Treatment"),
    color= guide_legend(title="Treatment"))+
  scale_color_scico_d(begin = 0.9, end = 0.1, palette = a_palette)+
  scale_fill_scico_d(begin = 0.9, end = 0.1, palette = a_palette)
ggsave("24_gsw_pred_CI.svg", path = "C:/Github/Thesis/figures/TIP24",
       width = 10, height = 6)
ggsave("24_gsw_pred_CI.png", path = "C:/Github/Thesis/figures/TIP24",
       width = 10, height = 6)
## phips2
mod24_ps2 <- lmer(logit(phips2) ~ treatment + daysfromgermination + (1 | Device),
                       data = d24_ps2_joined)
summary(mod24_ps2)
AIC(mod24_ps2)
r.squaredGLMM(mod24_ps2)
comps <- glht(mod24_ps2, linfct=mcp(treatment="Tukey"))
mod24_ps2_letters <- cld(comps)$mcletters$Letters
print(mod24_ps2_letters)

mod24_ps2_2 <- lm(logit(phips2)~treatment+daysfromgermination, data=d24_ps2_joined)
predict_plot(mod24_ps2_2, d24_ps2_joined, phips2, daysfromgermination, treatment, 100, correction = "logit")+
  ylab("Photosystem II Efficiency (PhiPS2)")+
  xlab("Days From Germination")+
  ylim(0.55, 0.8)+
  labs(
    title=NULL,
    subtitle = NULL
  ) +
  guides(
    fill = guide_legend(title="Treatment"),
    color= guide_legend(title="Treatment"))+
  scale_color_scico_d(begin = 0.9, end = 0.1, palette = a_palette)+
  scale_fill_scico_d(begin = 0.9, end = 0.1, palette = a_palette)
ggsave("24_phi2_pred_CI.svg", path = "C:/Github/Thesis/figures/TIP24",
       width = 10, height = 6)
ggsave("24_phi2_pred_CI.png", path = "C:/Github/Thesis/figures/TIP24",
       width = 10, height = 6)
### box plot of logit PhiPS2 by treatment
ggplot(data = d24_ps2_joined, aes(x= treatment, y = phips2, 
                         fill=treatment, color=treatment, shape = Device)) +
  geom_boxplot(alpha=.5, width=0.5, outliers = FALSE)+
  geom_jitter( width=.15, height=0)+
  scale_fill_manual(values=four_colors)+
  scale_color_manual(values=four_colors)+
  labs(
    title=NULL,
    subtitle = NULL
  ) +
  ylab("Photosystem II Efficiency (PhiPS2)")+
  xlab("Treatment")+
  annotate("text", x=1:4, y=0.8, label = mod24_ps2_letters, size=10, family="open")+
  ylim(0.55, 0.8)+
  theme_bw()+
    guides(
    fill = guide_legend(title="Treatment"),
    color= guide_legend(title="Treatment"))+
  theme(
    legend.position="right",
    text = element_text(size=subtitle_size, family="mont", lineheight=0.8),
    axis.title = element_text(size=subtitle_size, family = "mont", face= "bold"),
    title = element_text(size=title_size, family="open", face="bold")
  )
ggsave("24_phi2_box_annotated.svg", path = "C:/Github/Thesis/figures/TIP24",
       width = 10, height = 8)
ggsave("24_phi2_box_annotated.png", path = "C:/Github/Thesis/figures/TIP24",
       width = 10, height = 8)
```
